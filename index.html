<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã¤ã¾ã‚‰ãªã„ãŠä¸–è©±ã‚²ãƒ¼ãƒ </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 20px;
      font-family: 'Hiragino Sans', 'Yu Gothic', system-ui, sans-serif;
      background: radial-gradient(circle at top, #ffe4f3 0%, #fff6e5 45%, #ffeecf 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .container {
      max-width: 960px;
      width: 100%;
      margin: 0 auto;
      background: #fff7e9;
      border-radius: 24px;
      padding: 24px 20px 22px;
      box-shadow: 0 14px 40px rgba(0, 0, 0, 0.16);
    }

    .header {
      text-align: center;
      margin-bottom: 18px;
    }

    .main-title {
      font-size: 1.9rem;
      color: #7b3a2e;
      margin-bottom: 6px;
      font-weight: 800;
    }

    .subtitle {
      font-size: 0.95rem;
      color: #a06340;
      margin-bottom: 8px;
      line-height: 1.6;
    }

    .hint {
      font-size: 0.8rem;
      color: #b07a52;
      opacity: 0.9;
    }

    @media (max-width: 640px) {
      .container { padding: 18px 14px 16px; }
      .main-title { font-size: 1.6rem; }
    }

    /* ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ */
    #gameContainer { display: none; }

    .start-body {
      text-align: center;
      margin-top: 10px;
      line-height: 1.8;
      color: #5b3624;
      font-size: 0.95rem;
    }

    .start-list {
      text-align: left;
      display: inline-block;
      margin: 8px 0 4px;
      padding-left: 1.1em;
      font-size: 0.9rem;
      color: #6c4330;
    }

    .start-btn {
      margin-top: 14px;
      background: #ffcbdd;
      color: #5a2830;
      border: none;
      padding: 10px 26px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.18);
      transition: background 0.15s ease, transform 0.05s ease, box-shadow 0.05s ease;
    }

    .start-btn:hover {
      background: #ffd7e7;
      transform: translateY(-1px);
      box-shadow: 0 5px 14px rgba(0, 0, 0, 0.2);
    }

    .start-btn:active {
      transform: translateY(0);
      box-shadow: none;
    }

    /* ä¸Šæ®µï¼šãƒ¡ãƒ¼ã‚¿ãƒ¼ï¼‹ã‚­ãƒ£ãƒ© */
    .top-row {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 16px;
      margin-bottom: 14px;
    }

    @media (max-width: 720px) {
      .top-row { grid-template-columns: minmax(0, 1fr); }
    }

    .card {
      background: #fffaf2;
      border-radius: 18px;
      padding: 16px 16px 14px;
      border: 2px solid #f0d2aa;
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.06);
    }

    .card h2 {
      margin: 0 0 10px;
      font-size: 1rem;
      color: #7b3a2e;
      display: flex;
      align-items: center;
      gap: 4px;
      font-weight: 700;
    }

    /* ãƒ¡ãƒ¼ã‚¿ãƒ¼ */
    .meter-bar {
      width: 100%;
      height: 18px;
      background: #f3e3cf;
      border-radius: 999px;
      overflow: hidden;
      margin-bottom: 6px;
    }

    .meter-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #f9c0ff 0%, #ffc46b 40%, #ff7f7f 100%);
      transition: width 0.35s ease;
    }

    .meter-label {
      font-size: 0.82rem;
      font-weight: 600;
      color: #7b3a2e;
    }

    .meter-sub {
      font-size: 0.75rem;
      color: #a56c49;
      margin-top: 4px;
    }

    /* ã‚­ãƒ£ãƒ©è¡¨ç¤ºï¼ˆã‚¹ãƒ—ãƒ©ã‚¤ãƒˆï¼‰ */
    .character-growth { text-align: center; }

    .character-area {
      margin-top: 4px;
      background: #fff5e5;
      border-radius: 14px;
      padding: 10px 10px 8px;
      border: 1px solid #f0d2aa;
    }

    .character-display { margin-top: 4px; }

    .character-sprite {
      width: 192px;
      height: 256px;
      margin: 4px auto;
      background-repeat: no-repeat;
      background-size: 768px 768px;
      background-position: 0 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 64px;
      color: #5a3a2a;
    }

    .sprite-sheet {
      background-image: url("public/char/boring_chars.png");
    }

    /* 4åˆ—Ã—3è¡Œã§åˆ‡ã‚Šå‡ºã—ï¼ˆ1ãƒã‚¹ 192Ã—256pxï¼‰ */
    /* 1è¡Œç›® */
    .char-hokorin         { background-position:    0px     0px; }
    .char-nurezoukin      { background-position: -192px     0px; }
    .char-chap_denchi     { background-position: -384px     0px; }
    .char-post_kun        { background-position: -576px     0px; }
    /* 2è¡Œç›® */
    .char-inemuri_slipper { background-position:    0px  -256px; }
    .char-suberikomi_cal  { background-position: -192px  -256px; }
    .char-kumori_megane   { background-position: -384px  -256px; }
    .char-taoru_tan       { background-position: -576px  -256px; }
    /* 3è¡Œç›® */
    .char-wifi_obake      { background-position:    0px  -512px; }
    .char-tsumikasane_rec { background-position: -384px  -512px; }

    .character-status {
      font-size: 0.92rem;
      font-weight: 700;
      color: #7b3a2e;
      margin-bottom: 4px;
    }

    .progress-bar {
      width: 100%;
      height: 10px;
      background: #f3e3cf;
      border-radius: 999px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #ffc9de, #ffc46b);
      transition: width 0.3s ease;
    }

    .growth-stage {
      font-size: 0.78rem;
      color: #a56c49;
      margin-top: 3px;
    }

    .character-message {
      font-size: 0.8rem;
      color: #a56c49;
      margin: 4px 0 0;
      min-height: 2.1em;
    }

    /* ãŠä¸–è©±éƒ¨åˆ† */
    .current-card { margin-top: 6px; }

    .game-title {
      font-size: 1rem;
      font-weight: 700;
      color: #7b3a2e;
      margin: 0 0 8px;
      text-align: left;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
    }

    .game-title span {
      font-size: 0.8rem;
      font-weight: 500;
      color: #b07a52;
      white-space: nowrap;
    }

    .game-area {
      background: #fffdf7;
      border-radius: 14px;
      padding: 10px 10px 8px;
      border: 1px solid #f0d2aa;
    }

    .status {
      font-size: 1rem;
      color: #543123;
      margin: 0 0 6px;
      line-height: 1.7;
    }

    .task-hint {
      font-size: 0.78rem;
      color: #b07a52;
      margin: 0 0 8px;
    }

    .care-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 8px 0 6px;
    }

    .btn {
      background: #ffcbdd;
      color: #5a2830;
      border: none;
      padding: 7px 10px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: background 0.15s ease, transform 0.05s ease, box-shadow 0.05s ease, opacity 0.15s ease;
      white-space: nowrap;
    }

    .btn:nth-child(2) { background: #ffe3b8; }
    .btn:nth-child(3) { background: #daf3c4; }

    .btn:hover:enabled {
      background: #ffd7e7;
      transform: translateY(-1px);
      box-shadow: 0 3px 7px rgba(0, 0, 0, 0.16);
    }

    .btn:active:enabled {
      transform: translateY(0);
      box-shadow: none;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }

    .care-buttons.disabled .btn {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .small-btn {
      font-size: 0.78rem;
      padding: 6px 10px;
      margin-top: 4px;
    }

    .log-message {
      font-size: 0.8rem;
      color: #a56c49;
      min-height: 1.4em;
      margin-top: 2px;
    }

    .result-box {
      font-size: 0.82rem;
      color: #543123;
      margin-top: 6px;
      padding-top: 6px;
      border-top: 1px dashed #e0c09a;
      display: none;
    }

    .result-box ul {
      padding-left: 1.2em;
      margin: 4px 0;
    }

    footer {
      margin-top: 8px;
      text-align: center;
      font-size: 0.72rem;
      color: #a56c49;
      opacity: 0.8;
    }

    /* ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒŠãƒ¼ */
    .collection-title {
      font-size: 0.98rem;
      font-weight: 700;
      color: #7b3a2e;
      margin: 0 0 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .collection-sub {
      font-size: 0.76rem;
      color: #a56c49;
      margin-bottom: 4px;
    }

    .collection-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1.4fr);
      gap: 10px;
      margin-top: 6px;
    }

    @media (max-width: 720px) {
      .collection-layout {
        grid-template-columns: 1fr;
      }
    }

    .collection-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 8px;
    }

    .collection-item {
      background: #fffdf7;
      border-radius: 12px;
      padding: 6px;
      border: 1px solid #f0d2aa;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      transition: background 0.12s ease, transform 0.06s ease, box-shadow 0.06s ease;
      font-size: 0.78rem;
      color: #7b3a2e;
      text-align: center;
    }

    .collection-item:hover {
      background: #ffece0;
      transform: translateY(-1px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    }

    .collection-item.active {
      background: #ffe6f2;
      box-shadow: 0 2px 6px rgba(0,0,0,0.18);
    }

    .collection-thumb {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      background: #fff5e5;
      border: 1px solid #f0d2aa;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
    }

    .collection-thumb img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .collection-name {
      line-height: 1.2;
    }

    .collection-detail {
      background: #fffdf7;
      border-radius: 12px;
      border: 1px solid #f0d2aa;
      padding: 8px 10px;
      font-size: 0.8rem;
      color: #5b3624;
    }

    .collection-detail-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
    }

    .collection-detail-name {
      font-size: 0.95rem;
      font-weight: 700;
      color: #7b3a2e;
      margin-bottom: 2px;
    }

    .collection-detail-tag {
      font-size: 0.78rem;
      color: #a56c49;
    }

    .collection-detail-text {
      font-size: 0.8rem;
      line-height: 1.6;
      margin-top: 4px;
      white-space: pre-line;
    }

    .collection-detail-note {
      font-size: 0.75rem;
      color: #a56c49;
      margin-top: 4px;
    }

    /* ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .analysis-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 12px;
    }

    .analysis-content {
      background: #fffaf4;
      border-radius: 20px;
      padding: 16px 16px 14px;
      max-width: 420px;
      width: 100%;
      text-align: left;
      border: 2px solid #f0d2aa;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .analysis-title {
      font-size: 1rem;
      color: #7b3a2e;
      margin-bottom: 6px;
      font-weight: 700;
    }

    .mini-caption {
      font-size: 0.8rem;
      color: #a56c49;
      margin-bottom: 8px;
    }

    .mini-area {
      position: relative;
      width: 100%;
      height: 150px;
      background: #fff3e3;
      border-radius: 14px;
      overflow: hidden;
      margin-bottom: 6px;
      border: 1px solid #f0d2aa;
      touch-action: none;
    }

    .mini-item {
      position: absolute;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #ffb7cf;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.18);
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #miniCatcher {
      position: absolute;
      bottom: 6px;
      width: 40px;
      height: 10px;
      border-radius: 10px;
      background: #ff9a59;
    }

    .mini-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
      font-size: 0.8rem;
      color: #7b4a27;
    }

    .mini-timer {
      font-feature-settings: "tnum";
      font-weight: 600;
    }

    .mini-counter {
      font-size: 0.78rem;
      opacity: 0.8;
      margin-top: 2px;
    }

    .mini-buttons {
      display: flex;
      gap: 6px;
    }

    .mini-btn {
      border-radius: 999px;
      border: none;
      padding: 6px 10px;
      font-size: 0.78rem;
      cursor: pointer;
      background: #ffe1c0;
      color: #5a2d1c;
    }

    .mini-btn:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .hidden { display: none; }

    /* ä¸¦ã¹ã‚‹ã‚²ãƒ¼ãƒ ç”¨ãƒ–ãƒ­ãƒƒã‚¯ */
    .mini-arrange-block {
      position: absolute;
      width: 24px;
      height: 24px;
      border-radius: 6px;
      background: #f5c9a5;
      box-shadow: 0 0 4px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      transition: top 0.2s ease, transform 0.1s ease, background 0.2s ease;
    }

    .mini-arrange-block.aligned {
      background: #f2b37e;
    }

    /* æƒé™¤ã‚²ãƒ¼ãƒ ç”¨æ±šã‚Œ */
    .mini-dirt {
      position: absolute;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #d0b58f;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.1s ease, opacity 0.15s ease;
    }

    .mini-dirt.tapped {
      transform: scale(0.8);
      opacity: 0.8;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
</head>
<body>

  <!-- ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
  <div id="startScreen" class="container">
    <header class="header">
      <h1 class="main-title" id="startMainTitle">ğŸ¥š ã¤ã¾ã‚‰ãªã„ãŠä¸–è©±ã‚²ãƒ¼ãƒ </h1>
      <p class="subtitle">
        å ±ã‚ã‚Œãªã„ãŠä¸–è©±ã‚’100å€‹ã ã‘è¦³å¯Ÿã™ã‚‹ã€å°ã•ãªå®Ÿé¨“ã‚²ãƒ¼ãƒ ã§ã™ã€‚<br>
        æ¯å›ã€ãŠä¸–è©±ã®æ–‡ç« ã‚’èª­ã‚“ã§ â†’ ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ã§ã€Œãªã‚“ã¨ãªããŠä¸–è©±ã€ â†’ ãã®ã‚ã¨ã§ã¤ã¾ã‚‰ãªã•ã‚’ã‚¸ãƒ£ãƒƒã‚¸ã—ã¾ã™ã€‚
      </p>
      <p class="hint">
        é€”ä¸­ã§ã€ãŸã¾ã” â†’ å¤‰ãªå¹¼è™« â†’ ã¸ã‚“ãªã•ãªã â†’ ç”Ÿæ´»ã®ã¤ã¾ã‚‰ãªã„ã‚­ãƒ£ãƒ©ãŸã¡ â†’ ãƒ©ã‚¹ãƒœã‚¹ã€Œã‚¨ãƒ³ãƒ‰ãƒ¬ã‚¹å®¶äº‹ãƒ¡ãƒ¢ã‚Šã‚“ã€ãŒç™»å ´ã—ã¾ã™ã€‚
      </p>
    </header>
    <div class="start-body">
      éŠã³æ–¹ã®æµã‚Œ
      <ul class="start-list">
        <li>1. ã¾ãšã¯ã€Œã¤ã¾ã‚‰ãªã„ãŠä¸–è©±ã€ã®æ–‡ç« ã‚’èª­ã‚€</li>
        <li>2. 5ç§’ã ã‘ã€ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ã§ã€Œãªã‚“ã¨ãªããŠä¸–è©±ã€ã™ã‚‹</li>
        <li>3. ä»Šã®æ°—åˆ†ã§ã¤ã¾ã‚‰ãªã•ã‚’ã‚¸ãƒ£ãƒƒã‚¸ã™ã‚‹</li>
      </ul>
      <div>100å€‹ã‚¸ãƒ£ãƒƒã‚¸ã™ã‚‹ã¨ã€ã‚ãªãŸå°‚ç”¨ã®ã€Œã¤ã¾ã‚‰ãªã„ãŠä¸–è©±ã®å†…è¨³ã€ã¨ãƒ©ã‚¹ãƒœã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
      <button id="startButton" class="start-btn">ã¯ã˜ã‚ã‚‹</button>
    </div>
  </div>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ç”»é¢ -->
  <div id="gameContainer" class="container">
    <header class="header">
      <h1 class="main-title" id="mainTitle">ğŸ¥š ã¤ã¾ã‚‰ãªã„ãŠä¸–è©±ã‚²ãƒ¼ãƒ </h1>
      <p class="subtitle" id="subtitle">å ±ã‚ã‚Œãªã„ãŠä¸–è©±ã‚’100å€‹ã“ãªã™ã¨ã€å¤‰ãªã‚­ãƒ£ãƒ©ãŒç”Ÿã¾ã‚Œã¾ã™ã€‚</p>
      <p class="hint">1ã¤ãšã¤ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ã§ã€Œãªã‚“ã¨ãªããŠä¸–è©±ã€â†’ ãã®å ´ã§ã¤ã¾ã‚‰ãªã„åº¦ã‚’ã‚¸ãƒ£ãƒƒã‚¸ã€‚</p>
    </header>

    <div class="top-row">
      <!-- ãƒ¡ãƒ¼ã‚¿ãƒ¼ -->
      <div class="card">
        <h2>ğŸ˜´ ã„ã¾ã®ã¤ã¾ã‚‰ãªã„åº¦</h2>
        <div class="meter-bar">
          <div class="meter-fill" id="boredomFill"></div>
        </div>
        <div class="meter-label" id="boredomLevel">
          0% - ã¾ã è¨ˆæ¸¬ã•ã‚Œã¦ã„ã¾ã›ã‚“
        </div>
        <div class="meter-sub" id="boredomSub">
          ã‚¸ãƒ£ãƒƒã‚¸ãŒå¢—ãˆã‚‹ã»ã©ã€ã“ã®ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒã˜ã‚ã˜ã‚å‹•ãã¾ã™ã€‚
        </div>
        <div class="meter-sub" id="boredomBreakdown"></div>
      </div>

      <!-- ã‚­ãƒ£ãƒ© -->
      <div class="card character-growth">
        <h2>ğŸŒ± æˆé•·ã™ã‚‹ã¤ã¾ã‚‰ãªã„ã‚­ãƒ£ãƒ©</h2>
        <div class="character-area">
          <div class="character-display">
            <div id="characterSprite" class="character-sprite">ğŸ¥š</div>
          </div>
          <div class="character-status" id="characterStatus">ï¼Ÿï¼Ÿï¼Ÿï¼ˆã¾ã ä¸–ç•Œã‚’çŸ¥ã‚‰ãªã„ãŸã¾ã”ï¼‰</div>
          <div class="progress-bar">
            <div class="progress-fill" id="growthProgress"></div>
          </div>
          <div class="growth-stage" id="growthStage">ã¤ã¾ã‚‰ãªã„ãŠä¸–è©±ï¼š0 / 100</div>
          <div class="character-message" id="characterMessage">
            ã¾ãšã¯1å›ã ã‘ã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€ã¨ã‚¸ãƒ£ãƒƒã‚¸ã—ã¦ã¿ã‚‹ã¨ã€æœ€åˆã®å¤‰ãªå¹¼è™«ãŒç”Ÿã¾ã‚Œã¾ã™ã€‚
          </div>
        </div>
      </div>
    </div>

    <!-- ãŠä¸–è©±éƒ¨åˆ† -->
    <div class="card current-card">
      <h3 class="game-title">
        <span id="taskLabel">No.1 ã®ã¤ã¾ã‚‰ãªã„ãŠä¸–è©±</span>
        <span id="taskStageLabel">1 / 100</span>
      </h3>
      <div class="game-area">
        <p class="status" id="taskText"></p>
        <p class="task-hint" id="taskHint">
          ã¾ãšã¯5ç§’ã ã‘ã€ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ã§ã€Œãªã‚“ã¨ãªããŠä¸–è©±ã€ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
        </p>

        <button class="btn small-btn" id="openMiniBtn">
          ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ã§ãªã‚“ã¨ãªããŠä¸–è©±ã™ã‚‹
        </button>

        <div class="care-buttons" id="ratingButtons">
          <button class="btn" data-score="0">ã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„</button>
          <button class="btn" data-score="1">ã¾ã‚ã¤ã¾ã‚‰ãªã„</button>
          <button class="btn" data-score="2">æ„å¤–ã¨å¥½ãã‹ã‚‚ã—ã‚Œãªã„</button>
        </div>
        <div class="log-message" id="logMessage"></div>
        <div class="result-box" id="resultBox"></div>
      </div>
    </div>

    <!-- ã‚­ãƒ£ãƒ©ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒŠãƒ¼ -->
    <div class="card" id="collectionCard">
      <p class="collection-title">
        ğŸ“š ã‚­ãƒ£ãƒ©ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
      </p>
      <p class="collection-sub">
        ãŸã¾ã”ãƒ»å¤‰ãªå¹¼è™«ãƒ»ã¸ã‚“ãªã•ãªããƒ»ç”Ÿæ´»ã‚­ãƒ£ãƒ©ãŸã¡ãƒ»ã²ã¾ãƒªãƒ³ãƒ»ãƒ©ã‚¹ãƒœã‚¹ã¾ã§ã€æˆé•·ãƒ«ãƒ¼ãƒˆã‚’ã‚ã¨ã‹ã‚‰çœºã‚ã‚‰ã‚Œã‚‹ã‚³ãƒ¼ãƒŠãƒ¼ã§ã™ã€‚
      </p>
      <div class="collection-layout">
        <div class="collection-list" id="collectionList">
          <!-- JSã§ç”Ÿæˆ -->
        </div>
        <div class="collection-detail" id="collectionDetail">
          <div class="collection-detail-header">
            <div class="collection-thumb" id="collectionDetailThumb">ğŸ¥š</div>
            <div>
              <div class="collection-detail-name" id="collectionDetailName">ãŸã¾ã”</div>
              <div class="collection-detail-tag" id="collectionDetailTag">æˆé•·å‰ã®çŠ¶æ…‹</div>
            </div>
          </div>
          <div class="collection-detail-text" id="collectionDetailText">
            ã‚²ãƒ¼ãƒ é–‹å§‹æ™‚ã®çŠ¶æ…‹ã€‚ã¾ã ä½•ã‚‚ã‚¸ãƒ£ãƒƒã‚¸ã—ã¦ã„ãªã„ã€å¯èƒ½æ€§ã ã‘ã¤ã¾ã£ãŸãŸã¾ã”ã§ã™ã€‚
          </div>
          <div class="collection-detail-note" id="collectionDetailNote">
            ã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€ã¨ã‚¸ãƒ£ãƒƒã‚¸ã—ã¦ã„ãã¨ã€ã“ã“ã«ä¸¦ã¶ã‚­ãƒ£ãƒ©ãŸã¡ãŒé †ç•ªã«ç¾ã‚Œã¾ã™ã€‚
          </div>
        </div>
      </div>
    </div>

    <footer>
      100å€‹ãœã‚“ã¶ã‚¸ãƒ£ãƒƒã‚¸ã™ã‚‹ã¨ã€ã€Œã¤ã¾ã‚‰ãªã„ãŠä¸–è©±ã®å†…è¨³ã€ã¨ãƒ©ã‚¹ãƒœã‚¹ã€Œã‚¨ãƒ³ãƒ‰ãƒ¬ã‚¹å®¶äº‹ãƒ¡ãƒ¢ã‚Šã‚“ã€ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
    </footer>
  </div>

  <!-- ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="analysis-modal" id="miniModal">
    <div class="analysis-content">
      <h2 class="analysis-title">ãƒŸãƒ‹ãŠä¸–è©±ã‚²ãƒ¼ãƒ </h2>
      <p class="mini-caption" id="miniCaption">
        ä»Šå›ã®ã€Œã¤ã¾ã‚‰ãªã„ãŠä¸–è©±ã€ã‚’ã€å°ã•ãªãƒŸãƒ‹ã‚²ãƒ¼ãƒ ã§å†ç¾ã—ã¦ã„ã¾ã™ã€‚ï¼ˆã‚ã¾ã‚Šæ„å‘³ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰
      </p>
      <div class="mini-area" id="miniArea">
        <div id="miniCatcher"></div>
      </div>
      <div class="mini-footer">
        <div>
          ã®ã“ã‚Š <span class="mini-timer" id="miniTimer">5.0</span> ç§’
          <div class="mini-counter" id="miniCounter">ã¨ã‚ŒãŸæ•°ï¼š0</div>
        </div>
        <div class="mini-buttons">
          <button class="mini-btn" id="miniStartBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
          <button class="mini-btn hidden" id="miniOkBtn">ã“ã®ãã‚‰ã„ã§OK</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ãƒ©ã‚¹ãƒœã‚¹ç”»åƒ
    const BOSS_IMAGE_PATH = "public/char/endless_memorin.png";

    // 10ã‚­ãƒ£ãƒ©ã®é€²åŒ–ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚²ãƒ¼ãƒ æœ¬ä½“ç”¨ï¼‰
    const evolutionCharacters = [
      { threshold: 5,  name: "ã»ã“ã‚Šã‚“",               className: "char-hokorin",
        msg: "ãµã‚ã£ã¨å¢—ãˆã¦ã„ãã€çµ‚ã‚ã‚‰ãªã„æƒé™¤ã®è±¡å¾´ã€‚ã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€ã¨ã‚¸ãƒ£ãƒƒã‚¸ã—ãŸå›æ•°ã«å¿œã˜ã¦ã€å°‘ã—ãšã¤å­˜åœ¨æ„ŸãŒå¢—ãˆã¾ã™ã€‚" },
      { threshold: 10, name: "ã¬ã‚Œãã†ãã‚“ã•ã‚“",       className: "char-nurezoukin",
        msg: "ãŒã‚“ã°ã£ã¦ã„ã‚‹ã®ã«ã€éƒ¨å±‹ã®ã‚­ãƒ¬ã‚¤ã•ã¯ã‚ã¾ã‚Šå¤‰ã‚ã‚‰ãªã„æ®µéšã§ã™ã€‚" },
      { threshold: 15, name: "ã¡ã‚ƒã·é›»æ± ï¼ˆ3ï¼…å¦–ç²¾ï¼‰",  className: "char-chap_denchi",
        msg: "ã¡ã‚‡ã£ã¨ã ã‘ç„¦ã‚‰ã›ã¦ãã‚‹ã€å®‰å¿ƒæ„Ÿã¨ä¸å®‰ã®ã‚ã„ã ã®ã¤ã¾ã‚‰ãªã•ã€‚" },
      { threshold: 20, name: "ãƒã‚¹ãƒˆãã‚“",             className: "char-post_kun",
        msg: "ã©ã‚Œã ã‘æœŸå¾…ã—ã¦ã‚‚ãƒãƒ©ã‚·ã°ã‹ã‚Šå‡ºã¦ãã‚‹ã€æƒ…å ±éå¤šãªã¤ã¾ã‚‰ãªã•ã‚¾ãƒ¼ãƒ³ã€‚" },
      { threshold: 25, name: "ã„ã­ã‚€ã‚Šã‚¹ãƒªãƒƒãƒ‘",       className: "char-inemuri_slipper",
        msg: "ãã‚ãˆã¦ã‚‚å¤–å‡ºã‚¤ãƒ™ãƒ³ãƒˆã«ã¯ãªã‚‰ãªã„ã€ã€Œãã‚ãˆã‚‹ã“ã¨ã€ãã®ã‚‚ã®ã®ä¸–ç•Œã€‚" },
      { threshold: 30, name: "ã™ã¹ã‚Šã“ã¿ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãã‚“", className: "char-suberikomi_cal",
        msg: "æ—¥ä»˜ã ã‘ãŒæ·¡ã€…ã¨é€²ã‚“ã§ã„ãã€æ™‚é–“ç³»ã®ã¤ã¾ã‚‰ãªã•ã€‚" },
      { threshold: 35, name: "ãã‚‚ã‚Šãƒ¡ã‚¬ãƒã•ã‚“",       className: "char-kumori_megane",
        msg: "ãµã„ã¦ã‚‚ãµã„ã¦ã‚‚å®Œç’§ã«ãªã‚‰ãªã„ã€ã€Œè¦‹ãˆã«ãã•ã€ã¨ä»˜ãåˆã†æ®µéšã€‚" },
      { threshold: 40, name: "ã‚¿ã‚ªãƒ«ãŸã‚“",             className: "char-taoru_tan",
        msg: "åŠä¹¾ãã¨ã¨ã‚‚ã«ç”Ÿãã¦ã„ãã€ã€Œã¾ã‚ã“ã‚“ãªã‚‚ã®ã‹ã€ã¨ã„ã†ã¤ã¾ã‚‰ãªã•ã€‚" },
      { threshold: 45, name: "Wi-Fiã•ãŒã—ã®ãŠã°ã‘",    className: "char-wifi_obake",
        msg: "ã©ã“ã¾ã§æ¢ã—ã¦ã‚‚ã€Œè¶…é«˜é€Ÿï¼ã€ã«ã¯ãªã‚‰ãªã„ã€æ¢ã—ç¶šã‘ã‚‹ã¤ã¾ã‚‰ãªã•ã€‚" },
      { threshold: 50, name: "ã¤ã¿ã‹ã•ã­ãƒ¬ã‚·ãƒ¼ãƒˆãã‚“", className: "char-tsumikasane_rec",
        msg: "æ¨ã¦ã‚‹ã‹æ®‹ã™ã‹è¿·ã„ç¶šã‘ã‚‹ã€ç”Ÿæ´»ãƒ­ã‚°ç³»ã¤ã¾ã‚‰ãªã•ã®æœ€çµ‚å½¢ã€‚" }
    ];

    const bossCharacter = {
      name: "ã‚¨ãƒ³ãƒ‰ãƒ¬ã‚¹å®¶äº‹ãƒ¡ãƒ¢ã‚Šã‚“",
      img:  BOSS_IMAGE_PATH,
      msg:  "ã©ã‚Œã ã‘ãƒã‚§ãƒƒã‚¯ã—ã¦ã‚‚ã‚„ã‚‹ã“ã¨ãŒæ¸›ã‚‰ãªã„ã€ã€Œçµ‚ã‚ã‚‰ãªã„å®¶äº‹ãƒªã‚¹ãƒˆã€ã®åŒ–èº«ã§ã™ã€‚"
    };

    // ã¤ã¾ã‚‰ãªã„ãŠä¸–è©±100å€‹
    const tasks = [
      "ã‚¹ãƒãƒ›ã®å……é›»æ®‹é‡ã‚’æ¯æœãƒã‚§ãƒƒã‚¯ã™ã‚‹ï¼ˆè¦‹ã¦ã‚‚å……é›»ã¯å¢—ãˆãªã„ï¼‰",
      "è¦³è‘‰æ¤ç‰©ã®è‘‰ã£ã±ã®ã»ã“ã‚Šã‚’ãµãï¼ˆã™ãã«ã¾ãŸç©ã‚‚ã‚‹ï¼‰",
      "ä½¿ã£ã¦ã„ãªã„ã‚¢ãƒ—ãƒªã®é€šçŸ¥ã‚’ã‚ªãƒ•ã«ã™ã‚‹ï¼ˆèª°ã‚‚æ°—ã¥ã‹ãªã„ï¼‰",
      "å†·è”µåº«ã®è³å‘³æœŸé™ã‚·ãƒ¼ãƒ«ã‚’ãªãŒã‚ã¦ç¢ºèªã™ã‚‹ï¼ˆè¦‹ã‚‹ã ã‘ã§æ¸›ã‚‰ãªã„ï¼‰",
      "ãƒªãƒ¢ã‚³ãƒ³ã‚’ãã‚Œã„ã«ä¸¦ã¹ç›´ã™ï¼ˆã™ãèª°ã‹ãŒãšã‚‰ã™ï¼‰",
      "ãƒ†ã‚£ãƒƒã‚·ãƒ¥ã®ç®±ã‚’éƒ¨å±‹ã”ã¨ã«ãã‚ãˆã‚‹ï¼ˆèª°ã‚‚æ„Ÿè¬ã—ãªã„ï¼‰",
      "æ°´ç­’ã®ãƒ‘ãƒƒã‚­ãƒ³ã‚’æ¯å›ã¡ã‚ƒã‚“ã¨ã¯ã‚ã‚‹ï¼ˆé”æˆæ„Ÿã¯ã‚¼ãƒ­ï¼‰",
      "ãˆã‚“ã´ã¤ã‚’ä¸€æœ¬ã ã‘ãã‚Œã„ã«ã‘ãšã‚‹ï¼ˆç‰¹ã«ä½¿ã‚ã‚Œãªã„ï¼‰",
      "ã„ã‚‰ãªã„ãƒ¬ã‚·ãƒ¼ãƒˆã‚’ä¸€æšã ã‘æ¨ã¦ã‚‹ï¼ˆè²¡å¸ƒã¯ã¾ã ãƒ‘ãƒ³ãƒ‘ãƒ³ï¼‰",
      "ã‚«ãƒãƒ³ã®ä¸­ã®ã”ã¿ã‚’ä¸€å€‹ã ã‘æ¨ã¦ã‚‹ï¼ˆåŠ‡çš„ã«ã¯å¤‰ã‚ã‚‰ãªã„ï¼‰",
      "æœºã®ä¸Šã®ã‚‚ã®ã‚’å³ã‹ã‚‰å·¦ã¸ä¸¦ã¹æ›¿ãˆã‚‹ï¼ˆæ„å‘³ã¯ã‚ã¾ã‚Šãªã„ï¼‰",
      "ã‚«ãƒ¼ãƒ†ãƒ³ã®ã—ã‚ã‚’æ‰‹ã§ã®ã°ã™ï¼ˆã¾ãŸã—ã‚ãŒå¯„ã‚‹ï¼‰",
      "ã‚´ãƒŸç®±ã®ãƒ“ãƒ‹ãƒ¼ãƒ«è¢‹ã‚’ã´ã—ã£ã¨åºƒã’ã‚‹ï¼ˆèª°ã‚‚è¦‹ã¦ã„ãªã„ï¼‰",
      "ã‚³ãƒ³ã‚»ãƒ³ãƒˆã¾ã‚ã‚Šã®ã»ã“ã‚Šã‚’ã¡ã‚‡ã£ã¨ã ã‘å–ã‚‹ï¼ˆä¸–ç•Œã¯ã‚ã¾ã‚Šå¤‰ã‚ã‚‰ãªã„ï¼‰",
      "ãƒãƒ³ã‚«ãƒã‚’ãã‚Œã„ã«å››ã¤æŠ˜ã‚Šã«ãŸãŸã‚€ï¼ˆã™ããƒã‚±ãƒƒãƒˆã®ä¸­ã§ãã¡ã‚ƒãã¡ã‚ƒï¼‰",
      "ãƒªãƒƒãƒ—ã‚¯ãƒªãƒ¼ãƒ ã®ãµãŸã‚’ãã£ã¨é–‰ã‚ã‚‹ï¼ˆéŸ³ãŒé™ã‹ãªã ã‘ï¼‰",
      "æ¶ˆã—ã‚´ãƒ ã®ã‚«ã‚¹ã‚’é›†ã‚ã¦ä¸¸ã‚ã‚‹ï¼ˆä¸¸ã‚ãŸã‚«ã‚¹ã¯ã™ãæ¨ã¦ã‚‰ã‚Œã‚‹ï¼‰",
      "ãƒšãƒ³ç«‹ã¦ã®ãƒšãƒ³ã‚’è‰²é †ã«ãªã‚‰ã¹ã‚‹ï¼ˆèª°ã‚‚æ°—ã¥ã‹ãªã„ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰",
      "æ¯æœã€æ™‚è¨ˆã‚’ä¸€å›ã ã‘è¦‹ã¦ã€Œãµãƒ¼ã‚“ã€ã¨æ€ã†ï¼ˆç‰¹ã«ä½•ã‚‚å¤‰ã‚ã‚‰ãªã„ï¼‰",
      "ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜ã«å°ã•ãã€‡ã‚’ã¤ã‘ã‚‹ï¼ˆã¤ã‘ã¦ã‚‚äºˆå®šã¯å¢—ãˆãªã„ï¼‰",
      "ãƒã‚°ã‚«ãƒƒãƒ—ã®å–ã£æ‰‹ã®å‘ãã‚’ãã‚ãˆã‚‹ï¼ˆä½¿ã†ã¨ã™ããƒãƒ©ãƒãƒ©ï¼‰",
      "ã‚¤ã‚¹ã‚’æœºã«ãã¡ã‚“ã¨ã—ã¾ã†ï¼ˆã¾ãŸã™ãå‡ºã•ã‚Œã‚‹ï¼‰",
      "é´ã‚’ç„é–¢ã§ã¤ã¾å…ˆãã‚ãˆã¦ä¸¦ã¹ã‚‹ï¼ˆã™ãã«èª°ã‹ãŒå´©ã™ï¼‰",
      "ãƒ–ãƒ©ãƒ³ã‚±ãƒƒãƒˆã®å‘ãã‚’ãã‚Œã„ã«ç›´ã™ï¼ˆå¯ãŸã‚‰ã¾ãŸãšã‚Œã‚‹ï¼‰",
      "ãƒªãƒ¥ãƒƒã‚¯ã®ãƒãƒ£ãƒƒã‚¯ã‚’å…¨éƒ¨ã—ã‚ã‚‹ç¢ºèªã‚’ã™ã‚‹ï¼ˆèª°ã‚‚è¦‹ã¦ã„ãªã„å®‰å…¨ç¢ºèªï¼‰",
      "ãƒ†ãƒ¬ãƒ“ã®éŸ³é‡ã‚’ã„ã¤ã‚‚ã®æ•°å­—ã«æˆ»ã™ï¼ˆã“ã ã‚ã‚Šã¯è‡ªåˆ†ã ã‘ï¼‰",
      "éƒ¨å±‹ã®ã‚¹ã‚¤ãƒƒãƒã‚’å…¨éƒ¨ã‚ªãƒ•ã‹ç¢ºèªã™ã‚‹ï¼ˆã‚ªãƒ³ã«ã™ã‚‹ã®ã‚‚è‡ªåˆ†ï¼‰",
      "ãˆã‚“ã´ã¤ã®èŠ¯ã®é•·ã•ã‚’ãã‚ãˆã‚ˆã†ã¨ã—ã¦ã¿ã‚‹ï¼ˆå®Œç’§ã«ã¯ãã‚ã‚ãªã„ï¼‰",
      "ãƒãƒ¼ãƒˆã®è§’ã‚’ãã¡ã‚“ã¨åˆã‚ã›ã¦ãã‚ãˆã‚‹ï¼ˆã¾ãŸã™ããšã‚Œã‚‹ï¼‰",
      "ãƒ¡ã‚¬ãƒæ‹­ãã§ãƒ¡ã‚¬ãƒã‚’ä¸€æ‹­ãã ã‘ã™ã‚‹ï¼ˆä¸–ç•Œã®è¦‹ãˆæ–¹ã¯ã‚ã¾ã‚Šå¤‰ã‚ã‚‰ãªã„ï¼‰",
      "ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸Šã‚’æ‰‹ã®ã²ã‚‰ã§ã•ã£ã¨ãªã§ã¦ã‚´ãƒŸã‚’é›†ã‚ã‚‹ï¼ˆé›†ã‚ã¦ã‚‚ã™ãè½ã¡ã‚‹ï¼‰",
      "ãƒ—ãƒªãƒ³ãƒˆã®ç«¯ã‚’ãã‚ãˆã¦ãƒˆãƒ³ãƒˆãƒ³ã™ã‚‹ï¼ˆè‡ªå·±æº€è¶³ã®æ•´åˆ—ï¼‰",
      "ãƒã‚±ãƒƒãƒˆã«ä½•ã‚‚å…¥ã£ã¦ã„ãªã„ã‹ç¢ºèªã™ã‚‹ï¼ˆã»ã¼æ¯å›ä½•ã‚‚å…¥ã£ã¦ã„ãªã„ï¼‰",
      "ãƒã‚¹ã‚¯ã®äºˆå‚™ã‚’ä¸€æšã ã‘ã‚«ãƒãƒ³ã«å…¥ã‚Œã¦ãŠãï¼ˆä½¿ã‚ã‚Œãªã„ã¾ã¾ãã—ã‚ƒãã—ã‚ƒï¼‰",
      "ã‚¹ãƒãƒ›ç”»é¢ã®æŒ‡ç´‹ã‚’ã¡ã‚‡ã£ã¨ã ã‘ãµãï¼ˆã™ãã¾ãŸã¤ãï¼‰",
      "ãŠæ°—ã«å…¥ã‚Šã‚µã‚¤ãƒˆã®ã‚¿ãƒ–ã‚’é–‰ã˜ãšã«ä¸¦ã¹ç›´ã™ï¼ˆçµå±€å…¨éƒ¨è¦‹ã‚‹ã‚ã‘ã§ã¯ãªã„ï¼‰",
      "å……é›»ã‚±ãƒ¼ãƒ–ãƒ«ã‚’ãã‚‹ã£ã¨å·»ã„ã¦ãŠããªãŠã™ï¼ˆæ¬¡ã«ä½¿ã†ã¨ãã¾ãŸã»ã©ãï¼‰",
      "éµã®ä½ç½®ã‚’æ¯å›åŒã˜å ´æ‰€ã«æˆ»ã™ï¼ˆãã‚Œã§ã‚‚ãŸã¾ã«è¦‹å¤±ã†ï¼‰",
      "åŒã˜ãƒšãƒ³ã§ä»Šæ—¥ã®æ—¥ä»˜ã ã‘æ›¸ã„ã¦ã¿ã‚‹ï¼ˆèª°ã‚‚ãã®ã“ã ã‚ã‚Šã«æ°—ã¥ã‹ãªã„ï¼‰",
      "ã”ã¿ã®æ—¥ã‹ã©ã†ã‹ã ã‘ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ç¢ºèªã™ã‚‹ï¼ˆç¢ºèªã—ã¦ã‚‚å‡ºã—å¿˜ã‚Œã‚‹æ™‚ãŒã‚ã‚‹ï¼‰",
      "ä½¿ã£ã¦ã„ãªã„ãƒãƒ¼ãƒˆã®ä¸€æšç›®ã ã‘ã‚ãã£ã¦æˆ»ã™ï¼ˆç‰¹ã«æ„å‘³ã¯ãªã„ï¼‰",
      "ãƒ—ãƒªãƒ³ãƒˆã®ã‚¯ãƒªã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‰²ã”ã¨ã«åˆ†ã‘ã¦ã¿ã‚‹ï¼ˆä½¿ã†ã¨ãã¯çµå±€å…¨éƒ¨é–‹ã‘ã‚‹ï¼‰",
      "æ´—é¢å°ã®æ°´ã—ã¶ãã‚’æŒ‡ã§ãªã§ã¦æ¶ˆã™ï¼ˆæ•°åˆ†å¾Œã«ã¯ã¾ãŸæ°´ã—ã¶ãï¼‰",
      "ã‚¤ã‚¹ã®é«˜ã•ã‚’ã¡ã‚‡ã£ã¨ã ã‘èª¿æ•´ã™ã‚‹ï¼ˆé•ã„ã¯ã»ã¨ã‚“ã©åˆ†ã‹ã‚‰ãªã„ï¼‰",
      "ã‚¹ãƒªãƒƒãƒ‘ã‚’ãã‚ãˆã¦ã‚¹ã‚¿ãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ã‚’ä½œã‚‹ï¼ˆèª°ã‚‚ãã®ãƒ©ã‚¤ãƒ³ã‚’æ„è­˜ã—ãªã„ï¼‰",
      "ãƒ†ã‚£ãƒƒã‚·ãƒ¥ã‚’ä¸€æšã ã‘äºˆå‚™ã§ãƒã‚±ãƒƒãƒˆã«å…¥ã‚Œã‚‹ï¼ˆå­˜åœ¨ã‚’å¿˜ã‚Œã‚‰ã‚Œã‚‹ï¼‰",
      "ãŠæ°—ã«å…¥ã‚Šã®ã‚·ãƒ£ãƒ¼ãƒšãƒ³ã ã‘èŠ¯ã‚’è£œå……ã™ã‚‹ï¼ˆä»Šæ—¥ã¯åˆ¥ã®ãƒšãƒ³ã‚’ä½¿ã†ï¼‰",
      "æœºã®è§’ã¨ãƒãƒ¼ãƒˆã®è§’ã‚’ã´ã£ãŸã‚Šåˆã‚ã›ã¦ç½®ãï¼ˆã™ããšã‚Œã‚‹ï¼‰",
      "éƒ¨å±‹ã®æ™‚è¨ˆã¨ã‚¹ãƒãƒ›ã®æ™‚é–“ã‚’è¦‹æ¯”ã¹ã‚‹ï¼ˆã»ã¼åŒã˜ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã ã‘ï¼‰",
      "SNSã®é€šçŸ¥ãƒãƒ¼ã‚¯ã‚’å…¨éƒ¨æ¶ˆã—ã¦ã‚¼ãƒ­ã«ã™ã‚‹ï¼ˆã™ãã«ã¾ãŸ1ä»¶ã¤ãï¼‰",
      "å†·è”µåº«ã®ä¸­ã®ãƒšãƒƒãƒˆãƒœãƒˆãƒ«ã®å‘ãã‚’ãã‚ãˆã‚‹ï¼ˆèª°ã‚‚æ°—ã«ã—ãªã„æ•´åˆ—ï¼‰",
      "ãƒšãƒ³ã®ã‚­ãƒ£ãƒƒãƒ—ãŒã¡ã‚ƒã‚“ã¨ã¯ã¾ã£ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹ï¼ˆã¯ã¾ã£ã¦ã„ã¦ã‚‚å®‰å¿ƒæ„Ÿã ã‘ï¼‰",
      "ãˆã‚“ã´ã¤ã®åå‰ã‚·ãƒ¼ãƒ«ãŒã¯ãŒã‚Œã¦ãªã„ã‹è¦‹ã‚‹ï¼ˆè¦‹ã¦ã‚‚ç‰¹ã«ä½•ã‚‚ã—ãªã„ï¼‰",
      "ãƒ—ãƒªãƒ³ãƒˆã®ç©´ã‚ã‘ä½ç½®ã‚’æƒãˆã¦ãªãŒã‚ã‚‹ï¼ˆè¦‹ãŸç›®ãŒã¡ã‚‡ã£ã¨æ°—æŒã¡ã„ã„ã ã‘ï¼‰",
      "æ´—æ¿¯ç‰©ã®ãƒãƒ³ã‚¬ãƒ¼ã®å‘ãã‚’ãã‚ãˆã‚‹ï¼ˆé¢¨ãŒå¹ã„ãŸã‚‰çµ‚ã‚ã‚Šï¼‰",
      "ä»Šæ—¥ä½¿ã‚ãªã„æ–‡æˆ¿å…·ã‚’ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã‹ã‚‰ä¸€å€‹å‡ºã—ã¦ãŠãï¼ˆãŸã¶ã‚“æ˜æ—¥ã‚‚ä½¿ã‚ãªã„ï¼‰",
      "ãŠæ°—ã«å…¥ã‚Šã®ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ä¸€ã¤ã ã‘æŠ¼ã—ã¦æº€è¶³ã™ã‚‹ï¼ˆèª°ã‚‚ãã®1å€‹ã«æ°—ã¥ã‹ãªã„ï¼‰",
      "ã‚¹ãƒãƒ›ã®ãƒ›ãƒ¼ãƒ ç”»é¢ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä¸€å€‹ã ã‘ç§»å‹•ã™ã‚‹ï¼ˆé…ç½®ã¯ã»ã¨ã‚“ã©å¤‰ã‚ã‚‰ãªã„ï¼‰",
      "æ•™ç§‘æ›¸ã«ä»˜ç®‹ã‚’ä¸€æšã ã‘è²¼ã‚Šã‹ãˆã‚‹ï¼ˆãŸã¶ã‚“ãã“ã‚‚èª­ã¾ãªã„ï¼‰",
      "ã‚«ãƒ¼ãƒ†ãƒ³ã®é–‹ãå…·åˆã‚’å·¦å³å¯¾ç§°ã«ã¨ã¨ã®ãˆã‚‹ï¼ˆèª°ã‚‚å‚åŠ ã—ãªã„ã‚·ãƒ³ãƒ¡ãƒˆãƒªãƒ¼ï¼‰",
      "æ¤…å­ã®ä¸‹ã«ä½•ã‚‚è½ã¡ã¦ã„ãªã„ã‹ã®ããã“ã‚€ï¼ˆè¦‹ã¤ã‘ã¦ã‚‚æ‹¾ã†ã®ã¯è‡ªåˆ†ï¼‰",
      "ãˆã‚“ã´ã¤ã®é•·ã•é †ã«ä¸¦ã¹ã¦ãƒ‹ãƒ¤ãƒƒã¨ã™ã‚‹ï¼ˆã™ãã«é †ç•ªãŒãã¡ã‚ƒãã¡ã‚ƒï¼‰",
      "ãƒšãƒƒãƒˆãƒœãƒˆãƒ«ã®ãƒ©ãƒ™ãƒ«ã‚’ã¾ã£ã™ãã«æˆ»ã™ï¼ˆã¾ãŸã™ããšã‚Œã‚‹ï¼‰",
      "ã‚«ãƒãƒ³ã®ä¸­ã§ãƒšãƒ³ã‚±ãƒ¼ã‚¹ã®ä½ç½®ã‚’æ±ºã‚ã‚‹ï¼ˆæºã‚Œã‚‹ã¨å…ƒã©ãŠã‚Šï¼‰",
      "ä¸Šç€ã®ãƒ•ã‚¡ã‚¹ãƒŠãƒ¼ã‚’ä¸€ç•ªä¸Šã¾ã§ä¸Šã’ã¦ã¿ã‚‹ï¼ˆã™ãä¸‹ã‚ã™ï¼‰",
      "æœºã®å¼•ãå‡ºã—ã‚’ä¸€å›ã ã‘é–‹ã‘ã¦ä½•ã‚‚ã›ãšé–‰ã‚ã‚‹ï¼ˆå®‰å¿ƒæ„Ÿã ã‘å¢—ãˆã‚‹ï¼‰",
      "ãŠæ°—ã«å…¥ã‚Šæ¶ˆã—ã‚´ãƒ ã®è§’ã‚’ä¸€ã¤ã ã‘ä½¿ã£ã¦ã¿ã‚‹ï¼ˆèª°ã‚‚ãã®è§’ã®å¤‰åŒ–ã«æ°—ã¥ã‹ãªã„ï¼‰",
      "æ°´é“ã®ãƒ¬ãƒãƒ¼ã‚’ã¾ã£ã™ããªè§’åº¦ã«ãã‚ãˆã‚‹ï¼ˆæ¬¡ã®äººãŒã™ãå‹•ã‹ã™ï¼‰",
      "ãƒˆã‚¤ãƒ¬ãƒƒãƒˆãƒšãƒ¼ãƒ‘ãƒ¼ã®å…ˆç«¯ã‚’ä¸‰è§’ã«æŠ˜ã‚‹ï¼ˆèŠ¸è¡“ç‚¹ã ã‘ãŒä¸ŠãŒã‚‹ï¼‰",
      "ãƒ¡ãƒ¢å¸³ã®è¡¨ç´™ã‚’ãªã§ã¦ã‹ã‚‰ã‚«ãƒãƒ³ã«å…¥ã‚Œã‚‹ï¼ˆãªã§ã‚‰ã‚ŒãŸã“ã¨ã¯å¿˜ã‚Œã‚‰ã‚Œã‚‹ï¼‰",
      "ãƒªãƒ¢ã‚³ãƒ³ã®å‘ãã‚’ãƒ†ãƒ¬ãƒ“ã«ã´ã£ãŸã‚Šæƒãˆã¦ç½®ãï¼ˆä½¿ãˆã°ã™ãã‚ºãƒ¬ã‚‹ï¼‰",
      "ã¤ã‚ãã‚Šã‚’æ±ºã¾ã£ãŸå ´æ‰€ã«æˆ»ã™ã ã‘ã®ä»•äº‹ï¼ˆèª°ã‚‚æ°—ã¥ã‹ãªã„ç§©åºï¼‰",
      "USBãƒ¡ãƒ¢ãƒªã®ã‚­ãƒ£ãƒƒãƒ—ã‚’ãªãã—ã¦ãªã„ã‹ç¢ºèªã™ã‚‹ï¼ˆãªãã—ã¦ã‹ã‚‰ã§ã¯é…ã„ï¼‰",
      "ã‚«ã‚®æŸã®ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼ã®å‘ãã‚’æ•´ãˆã‚‹ï¼ˆæœ¬äººä»¥å¤–ã¯è¦‹ã¦ã„ãªã„ï¼‰",
      "ä»Šæ—¥ä½¿ã‚ãªã„ã‚«ãƒ¼ãƒ‰ã‚’è²¡å¸ƒã®å¥¥ã«ã—ã¾ã„ãªãŠã™ï¼ˆã¾ãŸåˆ¥ã®æ—¥ã«è¿·ã†ï¼‰",
      "é¡ã®å‰ã§å‰é«ªã‚’ä¸€å›ã ã‘ç›´ã™ï¼ˆå¤–ã«å‡ºãŸã‚‰é¢¨ã§çµ‚ã‚ã‚Šï¼‰",
      "æ¤…å­ã®è¶³ã‚’å…¨éƒ¨åŒã˜ç·šã®ä¸Šã«ãã‚ãˆã‚‹ï¼ˆèª°ã‚‚ãã®ãƒ©ã‚¤ãƒ³ã«æ°—ã¥ã‹ãªã„ï¼‰",
      "ã‚¹ãƒãƒ›ã®ç”»é¢ã®æ˜ã‚‹ã•ã‚’ã„ã¤ã‚‚ã®æ˜ã‚‹ã•ã«èª¿æ•´ã™ã‚‹ï¼ˆå¾®å¦™ãªå·®ï¼‰",
      "ä½¿ã„ã‹ã‘ã®ãƒãƒ¼ãƒˆã®ã—ãŠã‚Šã‚’ãã‚Œã„ã«å·®ã—ãªãŠã™ï¼ˆæ¬¡é–‹ãã¾ã§èª°ã‚‚çŸ¥ã‚‰ãªã„ï¼‰",
      "æœºã®ä¸Šã®æœ¬ã®ã‚¿ã‚¤ãƒˆãƒ«ãŒèª­ã‚ã‚‹å‘ãã«ãã‚ãˆã‚‹ï¼ˆèª°ã‚‚èª­ã¾ãªã„ã‹ã‚‚ã—ã‚Œãªã„ï¼‰",
      "ã‚¿ã‚ªãƒ«ã‚’ãã‚‹ã£ã¨å·»ã„ã¦åŒã˜é«˜ã•ã«ãã‚ãˆã‚‹ï¼ˆã™ãä½¿ã£ã¦å´©ã‚Œã‚‹ï¼‰",
      "ã‚«ãƒ¼ãƒ†ãƒ³ã®ã‚¿ãƒƒã‚»ãƒ«ã‚’ãã‚Œã„ãªä½ç½®ã«ç›´ã™ï¼ˆã¡ã‚‡ã£ã¨ã ã‘æº€è¶³ï¼‰",
      "ã”ã¿è¢‹ã®å£ã‚’ãã‚…ã£ã¨çµã³ç›´ã™ã ã‘ï¼ˆçµã³ç›´ã—ã¦ã‚‚ä¸­èº«ã¯åŒã˜ï¼‰",
      "æ´—é¢å°ã®ã‚³ãƒƒãƒ—ã‚’ã¾ã£ã™ãã®å‘ãã«ç½®ãï¼ˆã™ãèª°ã‹ãŒå›ã™ï¼‰",
      "ãƒãƒ³ãƒ‰ã‚¯ãƒªãƒ¼ãƒ ã‚’æ‰‹ã®ç”²ã«ä¸€å›ã ã‘å¡—ã‚‹ï¼ˆä¸–ç•Œã¯ã‚ã¾ã‚Šå¤‰ã‚ã‚‰ãªã„ï¼‰",
      "ä½¿ã„çµ‚ã‚ã£ãŸã‚¤ã‚¹ã‚’å…ƒã®å ´æ‰€ã«ã´ã£ãŸã‚Šæˆ»ã™ï¼ˆã¾ãŸã™ãå‹•ã‹ã•ã‚Œã‚‹ï¼‰",
      "æœºã®ä¸‹ã®è¶³å…ƒãƒãƒƒãƒˆã®å‘ãã‚’ç›´ã™ï¼ˆå‹•ããŸã³ã«ãšã‚Œã‚‹ï¼‰",
      "å……é›»å™¨ã®ã‚³ãƒ³ã‚»ãƒ³ãƒˆã‚’æ ¹å…ƒã¾ã§ã—ã£ã‹ã‚Šå·®ã—ã“ã‚€ï¼ˆã‚‚ã¨ã‚‚ã¨åˆºã•ã£ã¦ã„ã‚‹ã“ã¨ãŒå¤šã„ï¼‰",
      "ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰ã®ãƒšãƒ³ã‚’è‰²é †ã«ç½®ãç›´ã™ï¼ˆæˆæ¥­ã§é †ç•ªã¯å´©ã‚Œã‚‹ï¼‰",
      "ä»Šæ—¥ã®ãƒ—ãƒªãƒ³ãƒˆã‚’ä¸€æšã ã‘ãƒ•ã‚¡ã‚¤ãƒ«ã«ã—ã¾ã†ï¼ˆãã®1æšã ã‘å¦™ã«ä¸å¯§ï¼‰",
      "æ•™ç§‘æ›¸ã®è§’ãŒæŠ˜ã‚Œã¦ã„ãŸã‚‰ãã£ã¨ã®ã°ã™ï¼ˆã¾ãŸã™ãæŠ˜ã‚Œã‚‹ï¼‰",
      "ä½¿ã„çµ‚ã‚ã£ãŸãŠçš¿ã‚’ã‚·ãƒ³ã‚¯ã®ç«¯ã«ãã‚Œã„ã«é‡ã­ã‚‹ï¼ˆæ´—ã†ã®ã¯ã¾ã å…ˆï¼‰",
      "ãƒšãƒƒãƒˆãƒœãƒˆãƒ«ã®ã‚­ãƒ£ãƒƒãƒ—ã‚’é›†ã‚ã¦åŒã˜å ´æ‰€ã«å…¥ã‚Œã‚‹ï¼ˆç‰¹ã«ä½¿ã„é“ã¯æ±ºã¾ã£ã¦ã„ãªã„ï¼‰",
      "æŠ˜ã‚ŠãŸãŸã¿å‚˜ã®ãƒ’ãƒ¢ã‚’ã¡ã‚ƒã‚“ã¨å·»ãç›´ã™ï¼ˆæ¬¡ã«ä½¿ã†ã¨ãæ€¥ã„ã§ã»ã©ãï¼‰",
      "ãƒã‚±ãƒƒãƒˆãƒ†ã‚£ãƒƒã‚·ãƒ¥ã®æ®‹ã‚Šæšæ•°ã‚’ãªã‚“ã¨ãªãç¢ºèªã™ã‚‹ï¼ˆç¢ºèªã—ã¦ã‚‚å¢—ãˆãªã„ï¼‰",
      "ã‚¤ã‚¹ã®èƒŒã‚‚ãŸã‚Œã«ã‹ã‘ãŸä¸Šç€ã®ã—ã‚ã‚’ã®ã°ã™ï¼ˆåº§ã£ãŸã‚‰ã¾ãŸã—ã‚ï¼‰",
      "æœºã®ä¸Šã®å……é›»ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æœ¬ã ã‘ã»ã©ã„ã¦æ•´ãˆã‚‹ï¼ˆã™ãçµ¡ã¾ã‚‹ï¼‰",
      "é›»æ°—ã‚’æ¶ˆã™å‰ã«éƒ¨å±‹ã‚’ä¸€å›è¦‹å›ã™ï¼ˆç‰¹ã«å¤‰åŒ–ã¯ãªã„ï¼‰",
      "å¯ã‚‹å‰ã«æ•ã®ä½ç½®ã‚’ã¡ã‚‡ã£ã¨ã ã‘ä¸­å¤®ã«ç›´ã™ï¼ˆå¯è¿”ã‚Šã§ã™ãã‚ºãƒ¬ã‚‹ï¼‰",
      "ã€Œä»Šæ—¥ã‚‚ãªã‚“ã‹ä¸–è©±ã—ãŸãªã€ã¨å°ã•ãæ€ã„ãªãŒã‚‰å¯ã‚‹ï¼ˆèª°ã‚‚çŸ¥ã‚‰ãªã„æº€è¶³æ„Ÿï¼‰"
    ];
    const TOTAL_TASKS = tasks.length;

    // DOM
    const startScreenEl   = document.getElementById('startScreen');
    const gameContainerEl = document.getElementById('gameContainer');
    const startButtonEl   = document.getElementById('startButton');

    const boredomFillEl       = document.getElementById('boredomFill');
    const boredomLevelEl      = document.getElementById('boredomLevel');
    const boredomSubEl        = document.getElementById('boredomSub');
    const boredomBreakdownEl  = document.getElementById('boredomBreakdown');

    const characterSpriteEl   = document.getElementById('characterSprite');
    const characterStatusEl   = document.getElementById('characterStatus');
    const characterMessageEl  = document.getElementById('characterMessage');
    const growthProgressEl    = document.getElementById('growthProgress');
    const growthStageEl       = document.getElementById('growthStage');

    const taskLabelEl     = document.getElementById('taskLabel');
    const taskStageLabelEl= document.getElementById('taskStageLabel');
    const taskTextEl      = document.getElementById('taskText');
    const taskHintEl      = document.getElementById('taskHint');
    const ratingButtonsEl = document.getElementById('ratingButtons');
    const logMessageEl    = document.getElementById('logMessage');
    const resultBoxEl     = document.getElementById('resultBox');
    const openMiniBtn     = document.getElementById('openMiniBtn');

    const miniModalEl   = document.getElementById('miniModal');
    const miniCaptionEl = document.getElementById('miniCaption');
    const miniAreaEl    = document.getElementById('miniArea');
    const miniCatcherEl = document.getElementById('miniCatcher');
    const miniTimerEl   = document.getElementById('miniTimer');
    const miniCounterEl = document.getElementById('miniCounter');
    const miniStartBtn  = document.getElementById('miniStartBtn');
    const miniOkBtn     = document.getElementById('miniOkBtn');

    // ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ç”¨DOM
    const collectionListEl        = document.getElementById('collectionList');
    const collectionDetailThumbEl = document.getElementById('collectionDetailThumb');
    const collectionDetailNameEl  = document.getElementById('collectionDetailName');
    const collectionDetailTagEl   = document.getElementById('collectionDetailTag');
    const collectionDetailTextEl  = document.getElementById('collectionDetailText');
    const collectionDetailNoteEl  = document.getElementById('collectionDetailNote');

    // çŠ¶æ…‹
    let currentIndex = 0;
    const ratings = [];
    let miniPlayedForThisTask = false;

    // ãƒŸãƒ‹ã‚²ãƒ¼ãƒ çŠ¶æ…‹
    let miniPlaying = false;
    let miniStartTime = 0;
    const miniDuration = 5000;
    let miniTimerInterval = null;
    let miniGameInterval  = null;
    let miniItems = [];
    let miniCaught = 0;
    let catcherX = 0;

    let miniGameType   = 'fall';
    let currentMiniKind= 'normal';

    function countRatings() {
      let count0 = 0, count1 = 0, count2 = 0;
      ratings.forEach(r => {
        if (r === 0) count0++;
        else if (r === 1) count1++;
        else if (r === 2) count2++;
      });
      return { count0, count1, count2 };
    }

    function showEmoji(emoji) {
      characterSpriteEl.className = 'character-sprite';
      characterSpriteEl.style.backgroundImage = 'none';
      characterSpriteEl.style.backgroundSize = '768px 768px';
      characterSpriteEl.style.backgroundRepeat = 'no-repeat';
      characterSpriteEl.style.backgroundPosition = '0 0';
      characterSpriteEl.textContent = emoji;
    }

    function showSprite(className) {
      characterSpriteEl.className = 'character-sprite sprite-sheet ' + className;
      characterSpriteEl.style.backgroundImage = '';
      characterSpriteEl.style.backgroundSize = '768px 768px';
      characterSpriteEl.style.backgroundRepeat = 'no-repeat';
      characterSpriteEl.style.backgroundPosition = '';
      characterSpriteEl.textContent = '';
    }

    function showBoss() {
      characterSpriteEl.className = 'character-sprite';
      characterSpriteEl.style.backgroundImage = `url("${bossCharacter.img}")`;
      characterSpriteEl.style.backgroundSize = 'contain';
      characterSpriteEl.style.backgroundRepeat = 'no-repeat';
      characterSpriteEl.style.backgroundPosition = 'center';
      characterSpriteEl.textContent = '';
    }

    // ã²ã¾ãƒªãƒ³ï¼ˆç™’ã—ç³»ï¼‰ã®è¡¨ç¤º
    function showHimarin() {
      characterSpriteEl.className = 'character-sprite';
      characterSpriteEl.style.backgroundImage = 'url("public/char/himarin.png")'; /* ã“ã“ã‚’ä¿å­˜ã—ãŸãƒ‘ã‚¹ã«åˆã‚ã›ã¦ãã ã•ã„ */
      characterSpriteEl.style.backgroundSize = 'contain';
      characterSpriteEl.style.backgroundRepeat = 'no-repeat';
      characterSpriteEl.style.backgroundPosition = 'center';
      characterSpriteEl.textContent = '';
    }

    function updateCharacter() {
      const n = currentIndex;
      const { count0 } = countRatings();

      const percent = Math.min(100, (n / TOTAL_TASKS) * 100);
      growthProgressEl.style.width = percent + '%';
      growthStageEl.textContent = `ã¤ã¾ã‚‰ãªã„ãŠä¸–è©±ï¼š${Math.min(n, TOTAL_TASKS)} / ${TOTAL_TASKS}`;

      // å…¨éƒ¨çµ‚ã‚ã£ãŸã‚‰ãƒ©ã‚¹ãƒœã‚¹å›ºå®š
      if (n >= TOTAL_TASKS) {
        showBoss();
        characterStatusEl.textContent = `ãƒ©ã‚¹ãƒœã‚¹ï¼š${bossCharacter.name}`;
        characterMessageEl.textContent =
          bossCharacter.msg + "ã€€ä»Šæ—¥ã‚‚ã€Œã‚„ã‚‹ã“ã¨ãƒªã‚¹ãƒˆã€ã¯é™ã‹ã«ãƒšãƒ¼ã‚¸ã‚’å¢—ã‚„ã—ã¦ã„ãã¾ã™ã€‚";
        return;
      }

      // ã¾ã ã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€ãŒä¸€åº¦ã‚‚ãªã„ â†’ ãŸã¾ã”
      if (count0 === 0) {
        showEmoji("ğŸ¥š");
        characterStatusEl.textContent = "ï¼Ÿï¼Ÿï¼Ÿï¼ˆã¾ã ä¸–ç•Œã‚’çŸ¥ã‚‰ãªã„ãŸã¾ã”ï¼‰";
        characterMessageEl.textContent =
          "ã¾ãšã¯1å›ã ã‘ã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€ã¨ã‚¸ãƒ£ãƒƒã‚¸ã—ã¦ã¿ã‚‹ã¨ã€æœ€åˆã®å¤‰ãªå¹¼è™«ãŒç”Ÿã¾ã‚Œã¾ã™ã€‚";
        return;
      }

      // æ•°å›ã ã‘ â†’ å¹¼è™«
      if (count0 > 0 && count0 < 3) {
        showEmoji("ğŸª±");
        characterStatusEl.textContent = "å¤‰ãªå¹¼è™«ï¼ˆã¤ã¾ã‚‰ãªã•ã‚’é£Ÿã¹ã¦è‚²ã¤ï¼‰";
        characterMessageEl.textContent =
          `ã„ã¾ã¾ã§ã«ã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€ã¨ã‚¸ãƒ£ãƒƒã‚¸ã—ãŸå›æ•°ï¼š${count0} å›ã€‚ãã‚ãã‚ã•ãªãã«ãªã‚‹æº–å‚™ã‚’ã—ã¦ã„ã¾ã™ã€‚`;
        return;
      }

      // ã‚‚ã†å°‘ã—ãŸã¾ã‚‹ â†’ ã•ãªã
      if (count0 >= 3 && count0 < 5) {
        showEmoji("ğŸ«§");
        characterStatusEl.textContent = "ã¸ã‚“ãªã•ãªãï¼ˆã¤ã¾ã‚‰ãªã„ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’ãŸã‚è¾¼ã¿ä¸­ï¼‰";
        characterMessageEl.textContent =
          `ã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€ãŒ ${count0} å›åˆ†ãŸã¾ã£ã¦ãã¾ã—ãŸã€‚ã‚ã¨å°‘ã—ã§ç”Ÿæ´»æ„Ÿã®ã‚ã‚‹ã‚­ãƒ£ãƒ©ã¨ã—ã¦å­µåŒ–ã—ã¾ã™ã€‚`;
        return;
      }

      // ã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€ãŒã‹ãªã‚ŠãŸã¾ã£ãŸã‚‰ã€ç™’ã—ç³»ã²ã¾ãƒªãƒ³ã«åˆ°é”
      if (count0 >= 60) {
        showHimarin();
        characterStatusEl.textContent = "ã²ã¾ãƒªãƒ³ï¼ˆã²ã ã¾ã‚Šç™’ã—ç³»ã‚­ãƒ£ãƒ©ï¼‰";
        characterMessageEl.textContent =
          `ã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€ã‚’ ${count0} å›ã‚‚ã‚¸ãƒ£ãƒƒã‚¸ã—ãŸã‚ãªãŸã®å‰ã«ã€ã²ã¾ãƒªãƒ³ãŒç¾ã‚Œã¾ã—ãŸã€‚` +
          "ãŒã‚“ã°ã‚Šã™ããŸåˆ†ã ã‘ã€ã¡ã‚‡ã£ã¨ä¼‘ã‚“ã§ã‚‚ã„ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚";
        return;
      }

      // ãã‚Œä»¥å¤–ã¯ã€10ä½“ã®ç”Ÿæ´»ã‚­ãƒ£ãƒ©ã®ã©ã‚Œã‹
      let stage = evolutionCharacters[0];
      for (const s of evolutionCharacters) {
        if (count0 >= s.threshold) stage = s;
      }
      showSprite(stage.className);
      characterStatusEl.textContent = `ã¤ã¾ã‚‰ãªã„ã‚­ãƒ£ãƒ©ï¼š${stage.name}`;
      characterMessageEl.textContent =
        stage.msg + `ï¼ˆã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€ã¨ã‚¸ãƒ£ãƒƒã‚¸ã—ãŸå›æ•°ï¼š${count0} å›ï¼‰`;
    }

    function updateTask() {
      const no = currentIndex + 1;

      if (currentIndex >= TOTAL_TASKS) {
        taskLabelEl.textContent = `ã™ã¹ã¦ã®ãŠä¸–è©±ã‚’ã‚¸ãƒ£ãƒƒã‚¸ã—ã¾ã—ãŸ`;
        taskStageLabelEl.textContent = `${TOTAL_TASKS} / ${TOTAL_TASKS}`;
        taskTextEl.textContent =
          "ã“ã“ã‹ã‚‰å…ˆã¯ã€ã‚¨ãƒ³ãƒ‰ãƒ¬ã‚¹å®¶äº‹ãƒ¡ãƒ¢ã‚Šã‚“ãŒé™ã‹ã«ã‚ãªãŸã®ã€Œã‚„ã‚‹ã“ã¨ãƒªã‚¹ãƒˆã€ã‚’è¦‹å®ˆã‚Šã¾ã™ã€‚";
        taskHintEl.textContent =
          "ä¸‹ã®çµæœãƒœãƒƒã‚¯ã‚¹ã§ã€ä»Šæ—¥ã®ã¤ã¾ã‚‰ãªã„ãŠä¸–è©±ã®å†…è¨³ã‚’çœºã‚ã¦ã¿ã¦ãã ã•ã„ã€‚";
        openMiniBtn.style.display = 'none';
        return;
      }

      taskLabelEl.textContent = `No.${no} ã®ã¤ã¾ã‚‰ãªã„ãŠä¸–è©±`;
      taskStageLabelEl.textContent = `${no} / ${TOTAL_TASKS}`;
      taskTextEl.textContent = tasks[currentIndex];
      taskHintEl.textContent =
        'ã¾ãšã¯5ç§’ã ã‘ã€ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ã§ã€Œãªã‚“ã¨ãªããŠä¸–è©±ã€ã—ã¦ã¿ã¦ãã ã•ã„ã€‚ãã®ã‚ã¨ã§ã‚¸ãƒ£ãƒƒã‚¸ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚';
      logMessageEl.textContent = '';

      openMiniBtn.style.display = 'inline-block';
      openMiniBtn.textContent = 'ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ã§ãªã‚“ã¨ãªããŠä¸–è©±ã™ã‚‹';
    }

    function updateBoredomMeter() {
      if (ratings.length === 0) {
        boredomFillEl.style.width = '0%';
        boredomLevelEl.textContent = '0% - ã¾ã è¨ˆæ¸¬ã•ã‚Œã¦ã„ã¾ã›ã‚“';
        boredomSubEl.textContent = 'ã‚¸ãƒ£ãƒƒã‚¸ãŒå¢—ãˆã‚‹ã»ã©ã€ã“ã®ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒã˜ã‚ã˜ã‚å‹•ãã¾ã™ã€‚';
        boredomBreakdownEl.textContent =
          'ã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€ã€Œã¾ã‚ã¤ã¾ã‚‰ãªã„ã€ã€Œæ„å¤–ã¨å¥½ãã‹ã‚‚ã€ã®å›æ•°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚';
        return;
      }

      let totalScore = 0;
      ratings.forEach(r => {
        if (r === 0) totalScore += 100;
        else if (r === 1) totalScore += 60;
        else totalScore += 20;
      });

      const level = Math.round(totalScore / ratings.length);
      boredomFillEl.style.width = level + '%';

      let label = '';
      if      (level < 20) label = `${level}% - ã¾ã æ¥½ã—ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“`;
      else if (level < 40) label = `${level}% - ã¡ã‚‡ã£ã¨ã¤ã¾ã‚‰ãªã„ä¸–ç•Œ`;
      else if (level < 60) label = `${level}% - ã ã„ã¶ã¤ã¾ã‚‰ãªã„æ—¥å¸¸`;
      else if (level < 80) label = `${level}% - ã‹ãªã‚Šå ±ã‚ã‚Œãªã„ã‚¾ãƒ¼ãƒ³`;
      else                 label = `${level}% - çµ¶æœ›çš„ã«ã¤ã¾ã‚‰ãªã„ï¼ˆã„ã„æ„å‘³ã§ï¼‰`;

      boredomLevelEl.textContent = label;
      boredomSubEl.textContent   = `ã“ã‚Œã¾ã§ã« ${ratings.length} å€‹ã®ãŠä¸–è©±ã‚’ã‚¸ãƒ£ãƒƒã‚¸ã—ã¾ã—ãŸã€‚`;

      const { count0, count1, count2 } = countRatings();
      boredomBreakdownEl.textContent =
        `å†…è¨³ï¼š ã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€${count0}å› ï¼ ã€Œã¾ã‚ã¤ã¾ã‚‰ãªã„ã€${count1}å› ï¼ ã€Œæ„å¤–ã¨å¥½ãã‹ã‚‚ã€${count2}å›`;
    }

    function setButtonsEnabled(enabled) {
      if (enabled) ratingButtonsEl.classList.remove('disabled');
      else         ratingButtonsEl.classList.add('disabled');
      ratingButtonsEl.querySelectorAll('.btn').forEach(btn => {
        btn.disabled = !enabled;
      });
    }

    function showLastRatingMessage(score) {
      if      (score === 0) logMessageEl.textContent = 'ã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€ã¨ã‚¸ãƒ£ãƒƒã‚¸ã—ã¾ã—ãŸã€‚';
      else if (score === 1) logMessageEl.textContent = 'ã€Œã¾ã‚ã¤ã¾ã‚‰ãªã„ã€ã¨ã‚¸ãƒ£ãƒƒã‚¸ã—ã¾ã—ãŸã€‚';
      else                  logMessageEl.textContent = 'ã€Œæ„å¤–ã¨å¥½ãã‹ã‚‚ã—ã‚Œãªã„ã€ã¨ã‚¸ãƒ£ãƒƒã‚¸ã—ã¾ã—ãŸã€‚';
    }

    function showFinalSummary() {
      const { count0, count1, count2 } = countRatings();
      resultBoxEl.style.display = 'block';
      resultBoxEl.innerHTML =
        `<p>100å€‹ã™ã¹ã¦ã‚¸ãƒ£ãƒƒã‚¸ã—ã¾ã—ãŸã€‚</p>
         <p>ã¤ã¾ã‚‰ãªã„ãŠä¸–è©±ã®å†…è¨³ï¼š</p>
         <ul>
           <li>ã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€ï¼š${count0} å€‹</li>
           <li>ã€Œã¾ã‚ã¤ã¾ã‚‰ãªã„ã€ï¼š${count1} å€‹</li>
           <li>ã€Œæ„å¤–ã¨å¥½ãã‹ã‚‚ã—ã‚Œãªã„ã€ï¼š${count2} å€‹</li>
         </ul>
         <p>ã“ã®çµæœã‚’ãŸã©ã£ã¦ãŸã©ã‚Šç€ã„ãŸã®ãŒã€ãƒ©ã‚¹ãƒœã‚¹ã€Œã‚¨ãƒ³ãƒ‰ãƒ¬ã‚¹å®¶äº‹ãƒ¡ãƒ¢ã‚Šã‚“ã€ã§ã™ã€‚</p>
         <button class="btn small-btn" id="restartBtn">ã‚‚ã†ä¸€åº¦ã¯ã˜ã‚ã‹ã‚‰</button>`;

      document.getElementById('restartBtn').addEventListener('click', initGame);
    }

    function handleRating(score) {
      if (!miniPlayedForThisTask) {
        logMessageEl.textContent = 'ã¾ãšã¯ãƒŸãƒ‹ãŠä¸–è©±ã‚²ãƒ¼ãƒ ã§ã€5ç§’ã ã‘æ“ä½œã—ã¦ã¿ã¦ãã ã•ã„ã€‚';
        openMiniForCurrentTask();
        return;
      }

      ratings[currentIndex] = score;
      showLastRatingMessage(score);
      updateBoredomMeter();

      currentIndex++;
      miniPlayedForThisTask = false;

      if (currentIndex >= TOTAL_TASKS) {
        currentIndex = TOTAL_TASKS;
        updateCharacter();
        updateTask();
        setButtonsEnabled(false);
        openMiniBtn.style.display = 'none';
        showFinalSummary();
        logMessageEl.textContent = 'ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚ã¤ã¾ã‚‰ãªã„ãŠä¸–è©±ã®æ—…ã¯ã“ã“ã¾ã§ã§ã™ã€‚';
        return;
      }

      updateCharacter();
      updateTask();
      setButtonsEnabled(false);
    }

    // ãƒŸãƒ‹ã‚²ãƒ¼ãƒ å…±é€š
    function stopMiniGame() {
      miniPlaying = false;
      if (miniTimerInterval) { clearInterval(miniTimerInterval); miniTimerInterval = null; }
      if (miniGameInterval)  { clearInterval(miniGameInterval);  miniGameInterval  = null; }
      miniItems.forEach(obj => {
        if (obj.el && obj.el.parentNode === miniAreaEl) miniAreaEl.removeChild(obj.el);
      });
      miniItems = [];
    }

    function setupStaticMiniGame() {
      const rect = miniAreaEl.getBoundingClientRect();

      if (miniGameType === 'arrange') {
        const centerY = rect.height / 2;
        const count = 6;
        for (let i = 0; i < count; i++) {
          const block = document.createElement('div');
          block.className = 'mini-arrange-block';
          const x = (rect.width / (count + 1)) * (i + 1);
          const offsetY = (Math.random() * 40) - 20;
          const y = centerY + offsetY;
          block.style.left = (x - 12) + 'px';
          block.style.top  = (y - 12) + 'px';
          block.addEventListener('click', () => {
            miniCaught++;
            miniCounterEl.textContent = 'ã•ã‚ã£ãŸå›æ•°ï¼š' + miniCaught;
            block.style.top = (centerY - 12) + 'px';
            block.classList.add('aligned');
          });
          miniAreaEl.appendChild(block);
        }
      } else if (miniGameType === 'clean') {
        const spots = 8;
        for (let i = 0; i < spots; i++) {
          const dirt = document.createElement('div');
          dirt.className = 'mini-dirt';
          dirt.textContent = 'æ±š';
          const x = Math.random() * (rect.width  - 20) + 10;
          const y = Math.random() * (rect.height - 20) + 10;
          dirt.style.left = (x - 10) + 'px';
          dirt.style.top  = (y - 10) + 'px';
          dirt.addEventListener('click', () => {
            miniCaught++;
            miniCounterEl.textContent = 'ã“ã™ã£ãŸå›æ•°ï¼š' + miniCaught;
            dirt.classList.add('tapped');
            setTimeout(() => dirt.classList.remove('tapped'), 120);
          });
          miniAreaEl.appendChild(dirt);
        }
      }
    }

    function resetMiniGameView() {
      stopMiniGame();

      miniCaught = 0;
      miniTimerEl.textContent = '5.0';

      if (miniGameType === 'fall') {
        miniCounterEl.textContent = 'ã¨ã‚ŒãŸæ•°ï¼š0';
      } else if (miniGameType === 'clean') {
        miniCounterEl.textContent = 'ã“ã™ã£ãŸå›æ•°ï¼š0';
      } else {
        miniCounterEl.textContent = 'ã•ã‚ã£ãŸå›æ•°ï¼š0';
      }

      miniStartBtn.disabled = false;
      miniStartBtn.classList.remove('hidden');
      miniOkBtn.classList.add('hidden');

      while (miniAreaEl.firstChild) {
        miniAreaEl.removeChild(miniAreaEl.firstChild);
      }

      if (miniGameType === 'fall') {
        miniAreaEl.appendChild(miniCatcherEl);
        miniCatcherEl.style.display = 'block';

        const rect = miniAreaEl.getBoundingClientRect();
        catcherX = rect.width / 2;
        miniCatcherEl.style.left = (catcherX - 20) + 'px';
      } else {
        miniCatcherEl.style.display = 'none';
        setupStaticMiniGame();
      }
    }

    function startMiniGame() {
      stopMiniGame();
      miniPlaying = true;
      miniStartTime = performance.now();
      miniStartBtn.disabled = true;

      miniTimerInterval = setInterval(() => {
        const elapsed = performance.now() - miniStartTime;
        const remain = Math.max(0, (miniDuration - elapsed) / 1000);
        miniTimerEl.textContent = remain.toFixed(1);
        if (elapsed >= miniDuration) endMiniGame();
      }, 80);

      if (miniGameType === 'fall') {
        miniGameInterval = setInterval(updateMiniGame, 30);
      }
    }

    function endMiniGame() {
      if (!miniPlaying) return;
      stopMiniGame();
      miniStartBtn.classList.add('hidden');
      miniOkBtn.classList.remove('hidden');
      miniCaptionEl.textContent += "ã€€ãŸãã•ã‚“å‹•ã‹ã—ã¦ã‚‚ã€ç¾å®Ÿä¸–ç•Œã¯ã‚ã¾ã‚Šå¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚";
    }

    function updateMiniGame() {
      if (miniGameType !== 'fall') return;

      const areaRect = miniAreaEl.getBoundingClientRect();
      const catcherWidth = 40;
      const catcherY = areaRect.height - 6 - 10;

      if (Math.random() < 0.12) {
        const itemEl = document.createElement('div');
        itemEl.className = 'mini-item';

        let displayEmoji = '';
        if (currentMiniKind === 'poop')  displayEmoji = 'ğŸ’©';
        if (currentMiniKind === 'water') displayEmoji = 'ğŸ’§';

        let size = 14;
        if (displayEmoji) {
          itemEl.textContent = displayEmoji;
          itemEl.style.background = 'transparent';
          size = 22;
          itemEl.style.width = size + 'px';
          itemEl.style.height = size + 'px';
          itemEl.style.fontSize = '18px';
        }

        const x = Math.random() * (areaRect.width - size) + size / 2;
        const y = -size;
        itemEl.style.left = (x - size / 2) + 'px';
        itemEl.style.top  = y + 'px';
        miniAreaEl.appendChild(itemEl);
        miniItems.push({ x, y, el: itemEl, halfWidth: size / 2 });
      }

      const speed = 3;
      const newItems = [];
      miniItems.forEach(obj => {
        obj.y += speed;
        if (obj.y > areaRect.height + 20) {
          if (obj.el.parentNode === miniAreaEl) miniAreaEl.removeChild(obj.el);
          return;
        }

        const dx = obj.x - catcherX;
        if (obj.y >= catcherY - 10 && Math.abs(dx) < catcherWidth / 2 + obj.halfWidth) {
          miniCaught++;
          miniCounterEl.textContent = 'ã¨ã‚ŒãŸæ•°ï¼š' + miniCaught;
          if (obj.el.parentNode === miniAreaEl) miniAreaEl.removeChild(obj.el);
          return;
        }

        obj.el.style.top = obj.y + 'px';
        newItems.push(obj);
      });
      miniItems = newItems;

      miniCatcherEl.style.left = (catcherX - catcherWidth / 2) + 'px';
    }

    function onMiniPointerMove(e) {
      const rect = miniAreaEl.getBoundingClientRect();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      let x = clientX - rect.left;
      x = Math.max(20, Math.min(rect.width - 20, x));
      catcherX = x;
      const catcherWidth = 40;
      miniCatcherEl.style.left = (catcherX - catcherWidth / 2) + 'px';
    }

    function chooseMiniGameType(taskText) {
      const t = taskText;
      if (/(ãã‚ãˆ|ãã‚ãˆã‚‹|æƒãˆ|ä¸¦ã¹|ä¸¦ã³æ›¿ãˆ|é †ã«|ãƒ©ã‚¤ãƒ³)/.test(t)) {
        return 'arrange';
      }
      if (/(ã»ã“ã‚Š|ãƒ›ã‚³ãƒª|åŸƒ|ã‚´ãƒŸ|ã”ã¿|æ°´ã—ã¶ã|æ±šã‚Œ|æ±šã‚Œå…·åˆ)/.test(t)) {
        return 'clean';
      }
      return 'fall';
    }

    function openMiniForCurrentTask() {
      if (currentIndex >= TOTAL_TASKS) return;

      const taskNo = currentIndex + 1;
      const taskText = tasks[currentIndex] || "";
      const label = taskText.split('ï¼ˆ')[0];

      miniGameType = chooseMiniGameType(taskText);
      currentMiniKind = 'normal';

      if (miniGameType === 'fall') {
        if (taskNo % 18 === 0 && taskNo % 27 === 0) {
          currentMiniKind = Math.random() < 0.5 ? 'poop' : 'water';
        } else if (taskNo % 18 === 0) {
          currentMiniKind = 'poop';
        } else if (taskNo % 27 === 0) {
          currentMiniKind = 'water';
        }

        if (currentMiniKind === 'poop') {
          miniCaptionEl.textContent =
            `ã€Œ${label}ã€ã‚’ã€ãªãœã‹ğŸ’©ãŒè½ã¡ã¦ãã‚‹ã‚²ãƒ¼ãƒ ã§è¡¨ç¾ã—ã¦ã„ã¾ã™ã€‚ï¼ˆæœ¬å½“ã«æ„å‘³ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰`;
        } else if (currentMiniKind === 'water') {
          miniCaptionEl.textContent =
            `ã€Œ${label}ã€ã‚’ã€ãªãœã‹ğŸ’§ãŒè½ã¡ã¦ãã‚‹ã‚²ãƒ¼ãƒ ã§è¡¨ç¾ã—ã¦ã„ã¾ã™ã€‚ï¼ˆæœ¬å½“ã«æ„å‘³ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰`;
        } else {
          miniCaptionEl.textContent =
            `ã€Œ${label}ã€ã‚’ã€ä¸¸ã„ã‚‚ã®ã‚’æ‹¾ã†è½ã¡ã‚‚ã®ã‚²ãƒ¼ãƒ ã§ã–ã£ãã‚Šå†ç¾ã—ã¦ã„ã¾ã™ã€‚ï¼ˆã‚ã¾ã‚Šé–¢ä¿‚ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰`;
        }
      } else if (miniGameType === 'arrange') {
        miniCaptionEl.textContent =
          `ã€Œ${label}ã€ã‚’ã€ãƒãƒ©ãƒãƒ©ã®å››è§’ãƒ–ãƒ­ãƒƒã‚¯ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ä¸€åˆ—ã«ãã‚ãˆã‚‹ã‚²ãƒ¼ãƒ ã§å†ç¾ã—ã¦ã„ã¾ã™ã€‚ï¼ˆãã‚ãˆã¦ã‚‚ç‰¹ã«ä½•ã‚‚èµ·ãã¾ã›ã‚“ï¼‰`;
      } else if (miniGameType === 'clean') {
        miniCaptionEl.textContent =
          `ã€Œ${label}ã€ã‚’ã€æ±šã‚Œã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã‚‚ãœã‚“ãœã‚“æ¶ˆãˆãªã„æƒé™¤ã‚²ãƒ¼ãƒ ã§å†ç¾ã—ã¦ã„ã¾ã™ã€‚ï¼ˆã“ã™ã£ã¦ã‚‚ä¸–ç•Œã¯ã‚ã¾ã‚Šå¤‰ã‚ã‚Šã¾ã›ã‚“ï¼‰`;
      }

      miniModalEl.style.display = 'flex';
      resetMiniGameView();
    }

    miniAreaEl.addEventListener('mousemove', onMiniPointerMove);
    miniAreaEl.addEventListener('touchmove', e => {
      onMiniPointerMove(e);
      e.preventDefault();
    }, { passive: false });

    miniStartBtn.addEventListener('click', startMiniGame);

    miniOkBtn.addEventListener('click', () => {
      miniPlayedForThisTask = true;
      miniModalEl.style.display = 'none';
      setButtonsEnabled(true);
      openMiniBtn.textContent = 'ã‚‚ã†ä¸€åº¦ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ã‚’ã™ã‚‹';
      logMessageEl.textContent =
        'ãªã‚“ã¨ãªããŠä¸–è©±ã—ã¦ã¿ã¾ã—ãŸã­ã€‚ä»Šã®æ„Ÿè¦šã§ã€ã“ã®ãŠä¸–è©±ã®ã¤ã¾ã‚‰ãªã•ã‚’ã‚¸ãƒ£ãƒƒã‚¸ã—ã¦ã¿ã¦ãã ã•ã„ã€‚';
    });

    ratingButtonsEl.querySelectorAll('.btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const score = Number(btn.dataset.score);
        handleRating(score);
      });
    });

    openMiniBtn.addEventListener('click', openMiniForCurrentTask);

    function initGame() {
      currentIndex = 0;
      ratings.length = 0;
      miniPlayedForThisTask = false;
      resultBoxEl.style.display = 'none';
      resultBoxEl.innerHTML = '';
      setButtonsEnabled(false);
      updateCharacter();
      updateTask();
      updateBoredomMeter();
      logMessageEl.textContent = '';
    }

    function startGame() {
      startScreenEl.style.display = 'none';
      gameContainerEl.style.display = 'block';
      initGame();
    }

    startButtonEl.addEventListener('click', startGame);

    // ã‚­ãƒ£ãƒ©ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ç”¨ãƒ‡ãƒ¼ã‚¿
    const collectionCharacters = [
      {
        id: 'egg',
        name: 'ãŸã¾ã”',
        emoji: 'ğŸ¥š',
        tag: 'æˆé•·å‰ã®çŠ¶æ…‹',
        text: 'ã¾ã ä½•ã‚‚ã‚¸ãƒ£ãƒƒã‚¸ã—ã¦ã„ãªã„æœ€åˆã®çŠ¶æ…‹ã€‚\nã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€ã‚’1å›ã‚‚æŠ¼ã—ã¦ã„ãªã„ã¨ãã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚',
        note: 'ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ãŸã°ã‹ã‚Šã®ã€è‡ªåˆ†ã§ã‚‚ã‚ˆãåˆ†ã‹ã‚‰ãªã„ã€Œã¤ã¾ã‚‰ãªã•ã®ãŸã­ã€ã§ã™ã€‚'
      },
      {
        id: 'larva',
        name: 'å¤‰ãªå¹¼è™«',
        emoji: 'ğŸª±',
        tag: 'ã¤ã¾ã‚‰ãªã•ã‚’é£Ÿã¹ã¦è‚²ã¤',
        text: 'ã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€ã‚’1ã€œ2å›ãã‚‰ã„æŠ¼ã™ã¨ç¾ã‚Œã‚‹æ®µéšã§ã™ã€‚\nã¾ã å½¢ãŒå®šã¾ã‚‰ãšã€ã¤ã¾ã‚‰ãªã•ã‚’ã‚€ã—ã‚ƒã‚€ã—ã‚ƒé£Ÿã¹ã¦å¤§ãããªã‚ã†ã¨ã—ã¦ã„ã¾ã™ã€‚',
        note: 'ã¤ã¾ã‚‰ãªã„ã“ã¨ã‚’å°‘ã—èªã‚ã¯ã˜ã‚ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚'
      },
      {
        id: 'pupa',
        name: 'ã¸ã‚“ãªã•ãªã',
        emoji: 'ğŸ«§',
        tag: 'ã¤ã¾ã‚‰ãªã„ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’ãŸã‚è¾¼ã¿ä¸­',
        text: 'ã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€ãŒ3ã€œ4å›ã«ãªã‚‹ã¨ã€ã•ãªãçŠ¶æ…‹ã«ãªã‚Šã¾ã™ã€‚\nå¤–ã‹ã‚‰ã¯ä½•ã‚‚èµ·ãã¦ã„ãªã„ã‚ˆã†ã«è¦‹ãˆã¾ã™ãŒã€ä¸­ã§ã¯ç”Ÿæ´»ã‚­ãƒ£ãƒ©ã«å¤‰èº«ã™ã‚‹æº–å‚™ä¸­ã§ã™ã€‚',
        note: 'ã€Œãªã‚“ã‹ãƒ¢ãƒ¤ãƒ¢ãƒ¤ã™ã‚‹ã‘ã©ã€ã¾ã è¨€è‘‰ã«ã§ããªã„ã€æ™‚æœŸã«ã‚‚å°‘ã—ä¼¼ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚'
      },
      {
        id: 'hokorin',
        name: 'ã»ã“ã‚Šã‚“',
        image: 'public/chara/hokorin.png',
        tag: 'ãµã‚ã£ã¨å¢—ãˆã‚‹æƒé™¤ã‚­ãƒ£ãƒ©',
        text: 'éƒ¨å±‹ã®ã™ã¿ã£ã“ã§ãŸã¾ã£ã¦ã„ãã€ã»ã“ã‚Šã®å¦–ç²¾ã‚­ãƒ£ãƒ©ã€‚\nãµã¨æ°—ã¥ã„ãŸã¨ãã«ã¯ã€å­˜åœ¨æ„Ÿã ã‘ã˜ã‚ã˜ã‚å¢—ãˆã¦ã„ã¾ã™ã€‚',
        note: 'ã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€ã®å›æ•°ãŒå¢—ãˆã¦ãã‚‹ã¨ã€æœ€åˆã«å‡ºã¦ãã‚‹ç”Ÿæ´»ã‚­ãƒ£ãƒ©ã§ã™ã€‚'
      },
      {
        id: 'nurezoukin',
        name: 'ã¬ã‚Œãã†ãã‚“ã•ã‚“',
        image: 'public/chara/nurezoukin.png',
        tag: 'ã—ã¼ã‚‰ã‚Œå¾…ã¡ã‚¿ã‚ªãƒ«',
        text: 'ã³ã¡ã‚‡ã³ã¡ã‚‡ã®ã¾ã¾æ”¾ç½®ã•ã‚ŒãŒã¡ãªã€ã¬ã‚Œãã†ãã‚“ã‚­ãƒ£ãƒ©ã€‚\nãŒã‚“ã°ã£ã¦åƒã„ãŸã‚ã‚Šã«ã€ã‚ã¾ã‚Šæ„Ÿè¬ã•ã‚Œã¾ã›ã‚“ã€‚',
        note: 'ã€Œã‚„ã£ã¦ã„ã‚‹ã®ã«ã€å ±ã‚ã‚Œãªã„ã€ã¨ã„ã†æ„Ÿè¦šã«è¿‘ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚'
      },
      {
        id: 'chap_denchi',
        name: 'ã¡ã‚ƒã·é›»æ± ï¼ˆ3ï¼…å¦–ç²¾ï¼‰',
        image: 'public/chara/chap_denchi.png',
        tag: 'æ®‹é‡ã‚®ãƒªã‚®ãƒªç³»',
        text: 'ã„ã¤ã‚‚æ®‹é‡3ï¼…ãã‚‰ã„ã§ç”Ÿãã¦ã„ã‚‹é›»æ± ã‚­ãƒ£ãƒ©ã€‚\nã‚®ãƒªã‚®ãƒªãªã®ã«ã€ãªã‚“ã¨ã‹å‹•ãç¶šã‘ã¦ã—ã¾ã†ã¨ã“ã‚ãŒã‚ã‚Šã¾ã™ã€‚',
        note: 'ã¤ã¾ã‚‰ãªã„ãŠä¸–è©±ã«ã€ã¡ã‚‡ã£ã¨ã—ãŸç„¦ã‚ŠãŒæ··ã–ã‚Šã¯ã˜ã‚ãŸæ®µéšã§ã™ã€‚'
      },
      {
        id: 'post_kun',
        name: 'ãƒã‚¹ãƒˆãã‚“',
        image: 'public/chara/post_kun.png',
        tag: 'ãƒãƒ©ã‚·ã¾ã¿ã‚Œãƒã‚¹ãƒˆ',
        text: 'æœŸå¾…ã—ã¦é–‹ã‘ã¦ã‚‚ãƒãƒ©ã‚·ã°ã‹ã‚Šå‡ºã¦ãã‚‹ãƒã‚¹ãƒˆã‚­ãƒ£ãƒ©ã€‚\næƒ…å ±ã°ã‹ã‚Šå¢—ãˆã¦ã€ä¸­èº«ã¯ã‚ã¾ã‚Šå¤‰ã‚ã‚‰ãªã„æ—¥å¸¸ã‚’è±¡å¾´ã—ã¦ã„ã¾ã™ã€‚',
        note: 'ãŠçŸ¥ã‚‰ã›ã ã‘å¢—ãˆã¦ã„ãã€Œé€šçŸ¥ç¤¾ä¼šã€ã®ã¤ã¾ã‚‰ãªã•ã«ã‚‚é‡ãªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚'
      },
      {
        id: 'inemuri_slipper',
        name: 'ã„ã­ã‚€ã‚Šã‚¹ãƒªãƒƒãƒ‘',
        image: 'public/chara/inemuri_slipper.png',
        tag: 'ã•ã¾ã‚ˆã„é´ç³»',
        text: 'ç‰‡æ–¹ã ã‘ã‚½ãƒ•ã‚¡ã®ä¸‹ã«ã„ãŸã‚Šã™ã‚‹ã‚¹ãƒªãƒƒãƒ‘ã‚­ãƒ£ãƒ©ã€‚\nãã‚ãˆã¦ã‚‚ã‚¤ãƒ™ãƒ³ãƒˆã«ãªã‚‰ãªã„ã€ã§ã‚‚å°‘ã—ã‚¹ãƒƒã‚­ãƒªã™ã‚‹ã‚¿ã‚¤ãƒ—ã®ã¤ã¾ã‚‰ãªã„ãŠä¸–è©±ã§ã™ã€‚',
        note: 'ã€Œã‚„ã£ã¦ã‚‚èª°ã‚‚æ°—ã¥ã‹ãªã„ã‘ã©ã€è‡ªåˆ†ã¯ã¡ã‚‡ã£ã¨æ°—æŒã¡ã„ã„ã€ã‚¾ãƒ¼ãƒ³ã€‚'
      },
      {
        id: 'suberikomi',
        name: 'ã™ã¹ã‚Šã“ã¿ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãã‚“',
        image: 'public/chara/suberikomi_calendar.png',
        tag: 'æ—¥ä»˜ãŠãã‚Œç³»',
        text: 'å…ˆæœˆã®ã¾ã¾ã‚ãã‚‰ã‚Œã¦ã„ãªã„ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚­ãƒ£ãƒ©ã€‚\næ—¥ä»˜ã ã‘ãŒæ·¡ã€…ã¨é€²ã‚“ã§ã„ãæ„Ÿè¦šã¨ã€ã™ã“ã—ã®ã‚ã›ã‚Šã‚’èƒŒè² ã£ã¦ã„ã¾ã™ã€‚',
        note: 'æ™‚é–“ã ã‘ãŒé€²ã‚“ã§ã„ãã‚ˆã†ãªã€Œã¤ã¾ã‚‰ãªã•ã€ã‚’ã€ãã£ã¨å¼•ãå—ã‘ã¦ã„ã¾ã™ã€‚'
      },
      {
        id: 'kumori_megane',
        name: 'ãã‚‚ã‚Šãƒ¡ã‚¬ãƒã•ã‚“',
        image: 'public/chara/kumori_megane.png',
        tag: 'ãƒ¬ãƒ³ã‚ºã‚‚ã‚„ã‚‚ã‚„ç³»',
        text: 'æŒ‡ç´‹ã‚„ã»ã“ã‚Šã§å°‘ã—ãã‚‚ã£ã¦ã„ã‚‹ãƒ¡ã‚¬ãƒã‚­ãƒ£ãƒ©ã€‚\nãµã„ã¦ã‚‚ãµã„ã¦ã‚‚ã€ã©ã“ã‹å®Œç’§ã«ã¯ãªã‚‰ãªã„ä¸–ç•Œã®è¦‹ãˆæ–¹ã«ä¼¼ã¦ã„ã¾ã™ã€‚',
        note: 'ã€Œã¡ã‚‡ã£ã¨è¦‹ãˆã«ãã„ã€ãã‚‰ã„ã®é•å’Œæ„Ÿã¨ä»˜ãåˆã†æ®µéšã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚'
      },
      {
        id: 'taoru_tan',
        name: 'ã‚¿ã‚ªãƒ«ãŸã‚“',
        image: 'public/chara/taoru_tan.png',
        tag: 'ã‹ã‘ã£ã±ãªã—å¸ƒç³»',
        text: 'æ´—é¢æ‰€ã‚„ã‚­ãƒƒãƒãƒ³ã§ã¶ã‚‰ã•ãŒã£ã¦ã„ã‚‹ã‚¿ã‚ªãƒ«ã‚­ãƒ£ãƒ©ã€‚\nãã‚ãã‚æ´—ã„ãŸã„ã‘ã‚Œã©ã€ã€Œã¾ã‚ã¾ã å¤§ä¸ˆå¤«ã‹ã€ã¨æ€ã‚ã‚ŒãŒã¡ã§ã™ã€‚',
        note: 'ç”Ÿæ´»ã®ã€Œã¾ã‚ã„ã„ã‹ã€ãŒå°‘ã—ç©ã‚‚ã£ã¦ããŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«å‡ºã¦ãã¾ã™ã€‚'
      },
      {
        id: 'wifi_obake',
        name: 'Wi-Fiã•ãŒã—ã®ãŠã°ã‘',
        image: 'public/chara/wifi_obake.png',
        tag: 'é›»æ³¢ãµã‚‰ãµã‚‰ç³»',
        text: 'é›»æ³¢ãŒå¼±ã„ã¨ãã«ãµã‚ã£ã¨ç¾ã‚Œã‚‹ã€ãŠã°ã‘ã‚­ãƒ£ãƒ©ã€‚\nã©ã“ã‚’æ¢ã—ã¦ã‚‚æ±ºå®šçš„ã«å¼·ããªã‚‰ãªã„ã€æƒ…å ±ç’°å¢ƒã®ã¤ã¾ã‚‰ãªã•ã‚’èƒŒè² ã£ã¦ã„ã¾ã™ã€‚',
        note: 'ãƒ‡ã‚¸ã‚¿ãƒ«ãªã€Œã¤ãªãŒã‚Šã«ãã•ã€ãŒæ°—ã«ãªã£ã¦ããŸé ƒã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚'
      },
      {
        id: 'receipt',
        name: 'ã¤ã¿ã‹ã•ã­ãƒ¬ã‚·ãƒ¼ãƒˆãã‚“',
        image: 'public/chara/tsumikasane_receipt.png',
        tag: 'ç´™ã®å±±ç³»',
        text: 'ãƒ¬ã‚·ãƒ¼ãƒˆã‚„å°ã•ãªç´™ãŸã¡ã®å±±ã®ã‚­ãƒ£ãƒ©ã€‚\næ¨ã¦ã‚‹ã‹æ®‹ã™ã‹è¿·ã„ç¶šã‘ã‚‹ã€ç”Ÿæ´»ãƒ­ã‚°ç³»ã¤ã¾ã‚‰ãªã•ã®æœ€çµ‚å½¢ã§ã™ã€‚',
        note: 'ã“ã“ã¾ã§æ¥ã‚‹ã¨ã€ã€Œé¸ã³ç›´ã™ã“ã¨ã€ãã®ã‚‚ã®ãŒå°ã•ãªãƒ†ãƒ¼ãƒã«ãªã£ã¦ãã¾ã™ã€‚'
      },
      {
        id: 'himarin',
        name: 'ã²ã¾ãƒªãƒ³',
        image: 'public/char/himarin.png',  // ã“ã“ã‚‚ä¿å­˜ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«åã«åˆã‚ã›ã¦ãã ã•ã„
        tag: 'ã²ã ã¾ã‚Šç™’ã—ç³»ã‚­ãƒ£ãƒ©',
        text: 'ã²ã¾ã‚ã‚Šã®ã‚ˆã†ãªé¡”ã‚’ã—ãŸã€ã‚„ã•ã—ã„ç™’ã—ç³»ã‚­ãƒ£ãƒ©ã€‚\nã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€ã‚’ãŸãã•ã‚“ã‚¸ãƒ£ãƒƒã‚¸ã—ã¦ã€å°‘ã—ã¤ã‹ã‚Œã¦ããŸã“ã‚ã«ç¾ã‚Œã¾ã™ã€‚\n\nä½•ã‚‚ã—ãªã„æ™‚é–“ã‚„ã€ã¼ãƒ¼ã£ã¨ã™ã‚‹æ™‚é–“ã‚‚å¤§äº‹ã ã‚ˆã€ã¨é™ã‹ã«è¦‹å®ˆã‚‹å­˜åœ¨ã§ã™ã€‚',
        note: 'ã‚²ãƒ¼ãƒ æœ¬ç·¨ã§ã¯ã€ã€Œã“ã‚Œã¯ã¤ã¾ã‚‰ãªã„ã€ãŒä¸€å®šä»¥ä¸Šï¼ˆ60å›ã€œï¼‰ãŸã¾ã‚‹ã¨ç™»å ´ã—ã¾ã™ã€‚ãŒã‚“ã°ã‚Šã™ããŸè‡ªåˆ†ã‚’ã€ãã£ã¨ä¼‘ã¾ã›ã¦ãã‚Œã‚‹ãƒã‚¸ã‚·ãƒ§ãƒ³ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚'
      },
      {
        id: 'boss',
        name: bossCharacter.name,
        image: bossCharacter.img,
        tag: 'ãƒ©ã‚¹ãƒœã‚¹',
        text: bossCharacter.msg + "\n\nãƒã‚§ãƒƒã‚¯ã—ã¦ã‚‚ãƒã‚§ãƒƒã‚¯ã—ã¦ã‚‚çµ‚ã‚ã‚‰ãªã„ã€Œã‚„ã‚‹ã“ã¨ãƒªã‚¹ãƒˆã€ã®è±¡å¾´ã§ã™ã€‚",
        note: '100å€‹ã™ã¹ã¦ã®ãŠä¸–è©±ã‚’ã‚¸ãƒ£ãƒƒã‚¸ã™ã‚‹ã¨ç™»å ´ã—ã¾ã™ã€‚ã“ã“ã¾ã§ãŸã©ã‚Šç€ã„ãŸã¨ãã€è‡ªåˆ†ã®ã€Œã¤ã¾ã‚‰ãªã„ãŠä¸–è©±ã®å†…è¨³ã€ã‚’ã©ã†æ„Ÿã˜ã‚‹ã§ã—ã‚‡ã†ã‹ã€‚'
      }
    ];

    function renderCollectionList() {
      if (!collectionListEl) return;
      collectionListEl.innerHTML = '';
      collectionCharacters.forEach(ch => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'collection-item';
        btn.dataset.id = ch.id;

        const thumb = document.createElement('div');
        thumb.className = 'collection-thumb';

        if (ch.image) {
          const img = document.createElement('img');
          img.src = ch.image;
          img.alt = ch.name;
          thumb.appendChild(img);
        } else if (ch.emoji) {
          thumb.textContent = ch.emoji;
        } else {
          thumb.textContent = 'ï¼Ÿ';
        }

        const nameEl = document.createElement('div');
        nameEl.className = 'collection-name';
        nameEl.textContent = ch.name;

        btn.appendChild(thumb);
        btn.appendChild(nameEl);

        btn.addEventListener('click', () => setActiveCollectionCharacter(ch.id));

        collectionListEl.appendChild(btn);
      });
    }

    function setActiveCollectionCharacter(id) {
      const ch = collectionCharacters.find(c => c.id === id);
      if (!ch) return;

      document.querySelectorAll('.collection-item').forEach(el => {
        el.classList.toggle('active', el.dataset.id === id);
      });

      collectionDetailThumbEl.innerHTML = '';
      if (ch.image) {
        const img = document.createElement('img');
        img.src = ch.image;
        img.alt = ch.name;
        collectionDetailThumbEl.appendChild(img);
      } else if (ch.emoji) {
        collectionDetailThumbEl.textContent = ch.emoji;
      } else {
        collectionDetailThumbEl.textContent = 'ï¼Ÿ';
      }

      collectionDetailNameEl.textContent = ch.name;
      collectionDetailTagEl.textContent  = ch.tag || '';
      collectionDetailTextEl.textContent = ch.text || '';
      collectionDetailNoteEl.textContent = ch.note || '';
    }

    function initCollectionCorner() {
      if (!collectionListEl) return;
      renderCollectionList();
      setActiveCollectionCharacter('egg');
    }

    // Element SDK
    const defaultConfig = {
      main_title: "ğŸ¥š ã¤ã¾ã‚‰ãªã„ãŠä¸–è©±ã‚²ãƒ¼ãƒ ",
      subtitle: "å ±ã‚ã‚Œãªã„ãŠä¸–è©±ã‚’100å€‹ã“ãªã™ã¨ã€å¤‰ãªã‚­ãƒ£ãƒ©ãŒç”Ÿã¾ã‚Œã¾ã™ã€‚"
    };

    async function onConfigChange(config) {
      document.getElementById('mainTitle').textContent =
        config.main_title || defaultConfig.main_title;
      document.getElementById('subtitle').textContent =
        config.subtitle   || defaultConfig.subtitle;
      document.getElementById('startMainTitle').textContent =
        config.main_title || defaultConfig.main_title;
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ["main_title", config.main_title || defaultConfig.main_title],
        ["subtitle",   config.subtitle   || defaultConfig.subtitle]
      ]);
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }

    // æœ€å¾Œã«ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆæœŸåŒ–
    initCollectionCorner();
  </script>
</body>
</html>
