<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>つまらないお世話ゲーム - ホーム</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 20px;
      font-family: 'Hiragino Sans', 'Yu Gothic', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #8B5A3C 0%, #A0522D 100%);
      min-height: 100vh;
      color: #4A3A2A;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: #F5F5DC;
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
    }

    .header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 20px;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title-main {
      font-size: 1.8rem;
      font-weight: 700;
    }

    .title-sub {
      font-size: 0.9rem;
      opacity: 0.85;
    }

    .header-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 8px 18px;
      font-size: 0.9rem;
      cursor: pointer;
      background: #8B5A3C;
      color: #FDF7E6;
      box-shadow: 0 3px 0 #5c3923;
      transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.2s ease;
      white-space: nowrap;
    }

    .btn-secondary {
      background: #C89E5B;
      box-shadow: 0 3px 0 #906B32;
    }

    .btn:hover {
      transform: translateY(-1px);
      opacity: 0.9;
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 1px 0 rgba(0, 0, 0, 0.35);
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.2fr);
      gap: 20px;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: #FFF8E7;
      border-radius: 16px;
      padding: 18px;
      border: 2px solid #E0D2AA;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
    }

    .card-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-title-badge {
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: #E5D7B5;
    }

    /* ひまポンカード */

    .char-main {
      display: grid;
      grid-template-columns: 130px minmax(0, 1fr);
      gap: 12px;
      align-items: center;
    }

    @media (max-width: 600px) {
      .char-main {
        grid-template-columns: 1fr;
      }
    }

    .char-image-wrapper {
      width: 120px;
      height: 120px;
      border-radius: 28px;
      background: #FFFFFF;
      border: 1px solid #E6D6AA;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .char-image {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      image-rendering: auto;
    }

    .char-info-name {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .char-info-type {
      font-size: 0.85rem;
      opacity: 0.9;
      margin-bottom: 6px;
    }

    .char-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
    }

    .tag {
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: #E9DFC4;
    }

    .char-description {
      font-size: 0.9rem;
      line-height: 1.6;
      white-space: pre-line;
    }

    .char-footer-note {
      margin-top: 8px;
      font-size: 0.78rem;
      opacity: 0.75;
    }

    /* 右側：今日のお世話 */

    .task-list {
      font-size: 0.9rem;
      margin: 0;
      padding-left: 18px;
    }

    .task-list li {
      margin: 4px 0;
    }

    .task-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .task-refresh-tip {
      font-size: 0.75rem;
      opacity: 0.75;
    }

    .task-actions {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .counter-row {
      margin-top: 12px;
      padding: 8px 10px;
      border-radius: 12px;
      background: #F0E3C6;
      font-size: 0.85rem;
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.2fr);
      gap: 8px;
      align-items: center;
    }

    @media (max-width: 600px) {
      .counter-row {
        grid-template-columns: 1fr;
      }
    }

    .counter-label {
      font-weight: 600;
    }

    .counter-values {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: flex-end;
      font-feature-settings: "lnum";
    }

    .counter-pill {
      padding: 2px 8px;
      border-radius: 999px;
      background: #FDF7E6;
      border: 1px solid #D9C79E;
      font-size: 0.8rem;
    }

    .footer-note {
      margin-top: 12px;
      font-size: 0.78rem;
      opacity: 0.75;
    }

    .small-link-btn {
      font-size: 0.78rem;
      border: none;
      background: none;
      padding: 0;
      color: #8B5A3C;
      text-decoration: underline;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="title-block">
        <div class="title-main">つまらないお世話ゲーム</div>
        <div class="title-sub">
          どうでもいいようで、ちょっと大事な「お世話」を集めて、ひまポンとゆるく暮らすゲーム。
        </div>
      </div>
      <div class="header-buttons">
        <button class="btn-secondary btn" id="startCareBtn">
          今日のつまらないお世話をする
        </button>
        <button class="btn" id="charCollectionBtn">
          キャラコレクション
        </button>
      </div>
    </header>

    <main class="layout">
      <!-- 左：ひまポンカード -->
      <section class="card">
        <div class="card-title">
          ひまポンルーム
          <span class="card-title-badge">ひまわり癒し系</span>
        </div>

        <div class="char-main">
          <div class="char-image-wrapper">
            <!-- ひまポンの画像パスは必要に応じて変更してください -->
            <img src="public/chara/himapon.png" alt="ひまポン" class="char-image" id="himaponImage">
          </div>
          <div>
            <div class="char-info-name">ひまポン</div>
            <div class="char-info-type">
              がんばりすぎを見守る、ひだまり担当キャラ。
            </div>
            <div class="char-tags">
              <span class="tag">ひだまり担当</span>
              <span class="tag">がんばりすぎ防止係</span>
            </div>
            <div class="char-description" id="himaponDescription">
ひまわりのような顔をした、やさしい癒し系キャラ。
あなたが「つまらないお世話」をがんばりすぎていると、
そっとブレーキをかけてくれる。

何もしない時間や、ぼーっとする時間も大事だよ、と
静かに見守っている存在。
            </div>
            <div class="char-footer-note">
              このキャラについてもっと知りたくなったら、
              <button class="small-link-btn" id="openCollectionFromHimapon">
                キャラコレクションの「ひまポン」を見てみる
              </button>
              のもよいかもしれませんね。
            </div>
          </div>
        </div>
      </section>

      <!-- 右：今日のつまらないお世話 -->
      <section class="card">
        <div class="task-header-row">
          <div class="card-title">
            今日のつまらないお世話
            <span class="card-title-badge">ランダム3つ</span>
          </div>
          <div class="task-refresh-tip" id="lastUpdateLabel">
            ロードするとお世話が入れ替わります
          </div>
        </div>

        <ul class="task-list" id="taskList">
          <!-- JSで今日のお世話を3つ表示 -->
        </ul>

        <div class="task-actions">
          <button class="btn-secondary btn" id="didCareBtn">
            どれか1つはやった！（つまらない度＋1）
          </button>
          <button class="btn" id="rerollTasksBtn">
            お世話を入れ替える
          </button>
        </div>

        <div class="counter-row">
          <div>
            <div class="counter-label">つまらない度カウンター</div>
            <div>
              あなたの「つまらないお世話」の回数を、
              ひまポンがこっそり数えています。
            </div>
          </div>
          <div class="counter-values">
            <div class="counter-pill">
              トータル：<span id="totalCount">0</span> 回
            </div>
            <div class="counter-pill">
              ひまポン担当：<span id="himaponCount">0</span> 回
            </div>
          </div>
        </div>

        <div class="footer-note">
          回数はブラウザ内の保存機能（localStorage）に記録されています。
          別の端末や別のブラウザから見るとリセットされるかもしれませんね。  
          他のキャラごとのカウントも、そのうち増やしていける設計になっています。
        </div>
      </section>
    </main>
  </div>

  <script>
    // つまらないお世話の候補リスト
    const CARE_TASKS = [
      'リモコンの下だけ、さっと一ふきする',
      'ポストの一番上の手紙だけ中身を確認する',
      'スリッパをそろえて並べる',
      '机のはじっこをウェットティッシュでふく',
      'スマホを充電器にさしてから寝る',
      '今日使わないアプリを1つだけ閉じる',
      '洗面所のタオルを1枚だけ交換する',
      'メガネや画面をティッシュでそっと一ふきする',
      'いらないレシートを1枚だけ捨てる',
      'ルーター周りのほこりを軽くはらう',
      'カレンダーに今日の日付に丸をつける',
      'ノートやメモに、今日やったことを1つ書き足す',
      'ゴミ箱のまわりに落ちているゴミを1つ拾う',
      '冷蔵庫の中身を1つだけチェックする',
      'カバンの中からいらない紙を1枚だけ出す',
      'ティッシュ箱やリモコンをまっすぐに整える',
      '洗濯かごから一番上の服をたたむ',
      'いすを机にきちんと入れる',
      '電気を1か所だけ消しに行く',
      '何もしない時間を30秒だけつくって深呼吸する'
    ];

    // localStorageキー
    const STORAGE_KEY_TOTAL = 'boringTotalCount';
    const STORAGE_KEY_CHAR = 'boringCharCounts';
    const STORAGE_KEY_LAST_UPDATE = 'boringLastTaskUpdate';

    // DOM取得
    const charCollectionBtn = document.getElementById('charCollectionBtn');
    const openCollectionFromHimapon = document.getElementById('openCollectionFromHimapon');
    const startCareBtn = document.getElementById('startCareBtn');
    const didCareBtn = document.getElementById('didCareBtn');
    const rerollTasksBtn = document.getElementById('rerollTasksBtn');
    const taskListEl = document.getElementById('taskList');
    const totalCountEl = document.getElementById('totalCount');
    const himaponCountEl = document.getElementById('himaponCount');
    const lastUpdateLabelEl = document.getElementById('lastUpdateLabel');

    let currentTasks = [];

    function openCollection() {
      window.location.href = 'char_collection.html';
    }

    function loadCounts() {
      const total = parseInt(localStorage.getItem(STORAGE_KEY_TOTAL) || '0', 10);
      totalCountEl.textContent = total;

      let charCounts = {};
      try {
        const stored = localStorage.getItem(STORAGE_KEY_CHAR);
        if (stored) {
          charCounts = JSON.parse(stored);
        }
      } catch (e) {
        charCounts = {};
      }

      const hima = parseInt(charCounts.himapon || 0, 10);
      himaponCountEl.textContent = hima;
    }

    function saveCounts(deltaTotal = 0, deltaHimapon = 0) {
      const newTotal = parseInt(localStorage.getItem(STORAGE_KEY_TOTAL) || '0', 10) + deltaTotal;
      localStorage.setItem(STORAGE_KEY_TOTAL, String(newTotal));
      totalCountEl.textContent = newTotal;

      let charCounts = {};
      try {
        const stored = localStorage.getItem(STORAGE_KEY_CHAR);
        if (stored) {
          charCounts = JSON.parse(stored);
        }
      } catch (e) {
        charCounts = {};
      }

      const newHimapon = parseInt(charCounts.himapon || 0, 10) + deltaHimapon;
      charCounts.himapon = newHimapon;
      localStorage.setItem(STORAGE_KEY_CHAR, JSON.stringify(charCounts));
      himaponCountEl.textContent = newHimapon;
    }

    function formatDateTimeForLabel(d) {
      const year = d.getFullYear();
      const month = String(d.getMonth() + 1).padStart(2, '0');
      const day = String(d.getDate()).padStart(2, '0');
      const hour = String(d.getHours()).padStart(2, '0');
      const min = String(d.getMinutes()).padStart(2, '0');
      return year + '/' + month + '/' + day + ' ' + hour + ':' + min;
    }

    function updateLastUpdateLabel(updateNow) {
      if (updateNow) {
        const now = new Date();
        localStorage.setItem(STORAGE_KEY_LAST_UPDATE, now.toISOString());
      }

      const stored = localStorage.getItem(STORAGE_KEY_LAST_UPDATE);
      if (!stored) {
        lastUpdateLabelEl.textContent = 'ロードするとお世話が入れ替わります';
        return;
      }

      const date = new Date(stored);
      lastUpdateLabelEl.textContent = 'お世話リスト更新：' + formatDateTimeForLabel(date);
    }

    function chooseRandomTasks(count) {
      const indices = [...CARE_TASKS.keys()];
      for (let i = indices.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [indices[i], indices[j]] = [indices[j], indices[i]];
      }
      return indices.slice(0, count).map(i => CARE_TASKS[i]);
    }

    function renderTasks() {
      currentTasks = chooseRandomTasks(3);
      taskListEl.innerHTML = '';
      currentTasks.forEach(text => {
        const li = document.createElement('li');
        li.textContent = text;
        taskListEl.appendChild(li);
      });
      updateLastUpdateLabel(true);
    }

    document.addEventListener('DOMContentLoaded', () => {
      // ボタン動作
      if (charCollectionBtn) {
        charCollectionBtn.addEventListener('click', openCollection);
      }
      if (openCollectionFromHimapon) {
        openCollectionFromHimapon.addEventListener('click', openCollection);
      }
      if (startCareBtn) {
        startCareBtn.addEventListener('click', () => {
          // スクロールして今日のお世話カードへ
          const rect = taskListEl.getBoundingClientRect();
          window.scrollTo({
            top: window.scrollY + rect.top - 80,
            behavior: 'smooth'
          });
        });
      }
      if (didCareBtn) {
        didCareBtn.addEventListener('click', () => {
          saveCounts(1, 1); // トータル＋1、ひまポン担当＋1
          didCareBtn.textContent = 'おつかれさま！（もう1回カウントする）';
          setTimeout(() => {
            didCareBtn.textContent = 'どれか1つはやった！（つまらない度＋1）';
          }, 1200);
        });
      }
      if (rerollTasksBtn) {
        rerollTasksBtn.addEventListener('click', () => {
          renderTasks();
        });
      }

      // 初期表示
      loadCounts();
      renderTasks();
      updateLastUpdateLabel(false);
    });
  </script>
</body>
</html>
